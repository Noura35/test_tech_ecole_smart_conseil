{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Tech Test","text":"<p>Bienvenue dans la documentation de Tech Test, une application Django REST pour la gestion des utilisateurs, \u00e9coles et fichiers.</p>"},{"location":"#fonctionnalites-principales","title":"\u2728 Fonctionnalit\u00e9s principales","text":"<ul> <li>\ud83d\udd10 Authentification compl\u00e8te - Inscription, connexion et gestion s\u00e9curis\u00e9e des utilisateurs</li> <li>\ud83c\udfeb Gestion des \u00e9coles - CRUD complet pour les \u00e9tablissements</li> <li>\ud83d\udcc1 Gestion de fichiers - Upload et gestion de documents</li> <li>\ud83d\ude80 API REST - Endpoints document\u00e9s et test\u00e9s</li> <li>\ud83d\udc33 Docker ready - D\u00e9ploiement simplifi\u00e9 avec Docker</li> </ul>"},{"location":"#demarrage-rapide","title":"\ud83d\ude80 D\u00e9marrage rapide","text":"<p>=== \"Installation locale\"</p> <pre><code>    git clone https://github.com/Noura35/test_tech_ecole_smart_conseil\n    cd tech-test\n    python3 -m venv venv\n    source venv/bin/activate\n    pip install -r requirements.txt\n    cp .env.example .env\n    python manage.py migrate\n    python manage.py runserver\n</code></pre> <p>=== \"Installation Docker\"</p> <pre><code>    git clone https://github.com/Noura35/test_tech_ecole_smart_conseil\n    cd tech-test\n    docker-compose up --build\n</code></pre> <p>Serveur d\u00e9marr\u00e9</p> <p>Acc\u00e9dez \u00e0 l'application sur <code>http://localhost:8000/</code> (local) ou <code>http://localhost:8001/</code> (Docker)</p>"},{"location":"#technologies-utilisees","title":"\ud83d\udd27 Technologies utilis\u00e9es","text":"<ul> <li>Django 4.x - Framework web Python</li> <li>Django REST Framework - API REST</li> <li>PostgreSQL - Base de donn\u00e9es</li> <li>Docker - Conteneurisation</li> <li>MkDocs Material - Documentation</li> </ul>"},{"location":"api/app/","title":"Module App","text":"<p>Le module App contient la configuration principale du projet Django et g\u00e8re le routage global, ainsi que les interfaces ASGI/WSGI.</p>"},{"location":"api/app/#1-fichier-settingspy","title":"1. Fichier <code>settings.py</code>","text":"<ul> <li>Contient toutes les configurations du projet :</li> <li>Applications install\u00e9es</li> <li>Middleware</li> <li>Configuration de la base de donn\u00e9es</li> <li>Gestion des templates et statics</li> <li>Param\u00e8tres de s\u00e9curit\u00e9</li> <li>Configuration des JWT et DRF  </li> </ul> <p>settings.py - Configuration principale du projet Django</p> <p>Ce fichier d\u00e9finit les param\u00e8tres essentiels du projet, notamment : - Applications install\u00e9es - Middleware - Param\u00e8tres de base de donn\u00e9es - Authentification et autorisations - Configuration des fichiers statiques et m\u00e9dias - Internationalisation - Gestion des tests</p>"},{"location":"api/app/#2-fichier-urlspy","title":"2. Fichier <code>urls.py</code>","text":"<ul> <li>Configure le routing global du projet, incluant :</li> <li>Les routes des applications internes (<code>users</code>, <code>ecole</code>, etc.)</li> <li>Les endpoints d\u2019API  </li> <li>Sert de point d\u2019entr\u00e9e pour toutes les requ\u00eates HTTP.  </li> </ul> <p>urls.py - Routes principales du projet</p> <p>Ce module relie les diff\u00e9rentes applications internes du projet Django (et configure les endpoints d\u2019administration). Il d\u00e9finit les URL globales et inclut les routes sp\u00e9cifiques de chaque application.</p>"},{"location":"api/app/#3-fichier-asgipy","title":"3. Fichier <code>asgi.py</code>","text":"<ul> <li>Point d\u2019entr\u00e9e ASGI pour le projet.</li> <li>G\u00e8re les communications asynchrones (WebSockets, HTTP/2, etc.) si utilis\u00e9es.</li> <li>Permet le d\u00e9ploiement sur des serveurs ASGI comme Daphne ou Uvicorn.  </li> </ul> <p>asgi.py - Point d\u2019entr\u00e9e ASGI pour le d\u00e9ploiement asynchrone du projet Django.</p> <p>Ce fichier sert de passerelle entre le serveur ASGI (ex: Daphne, Uvicorn) et l'application Django. Il permet la gestion des requ\u00eates asynchrones, y compris WebSockets et HTTP, pour un traitement non bloquant.</p>"},{"location":"api/app/#4-fichier-wsgipy","title":"4. Fichier <code>wsgi.py</code>","text":"<ul> <li>Point d\u2019entr\u00e9e WSGI pour le projet.</li> <li>Utilis\u00e9 pour le d\u00e9ploiement sur des serveurs WSGI classiques (Gunicorn, uWSGI).</li> <li>Sert \u00e0 g\u00e9rer les requ\u00eates HTTP synchrones.  </li> </ul> <p>wsgi.py - Point d\u2019entr\u00e9e WSGI pour le d\u00e9ploiement du projet Django.</p> <p>Ce fichier sert de passerelle entre le serveur web (ex: Gunicorn, uWSGI) et l'application Django. Il permet au serveur de communiquer avec Django pour traiter les requ\u00eates HTTP.</p>"},{"location":"api/ecole/","title":"Module Ecole","text":"<p>Le module Ecole fournit une API REST compl\u00e8te pour la gestion des \u00e9tablissements scolaires, avec : - Authentification JWT - Gestion des permissions selon le r\u00f4le de l'utilisateur</p> <p>Le module inclut les composants suivants : mod\u00e8les, s\u00e9rialiseurs, vues, URLs et tests.</p>"},{"location":"api/ecole/#1-modeles-ecolemodels","title":"1. Mod\u00e8les (<code>ecole.models</code>)","text":"<ul> <li>D\u00e9finit le mod\u00e8le <code>Ecole</code> avec les attributs principaux d\u2019un \u00e9tablissement scolaire.  </li> <li>Sert de base pour les op\u00e9rations CRUD dans l\u2019API.  </li> </ul> <p>               Bases: <code>Model</code></p> <p>Repr\u00e9sente une \u00e9cole dans le syst\u00e8me de gestion.</p> <p>Ce mod\u00e8le contient les informations principales d'une \u00e9cole, telles que son nom, son adresse, sa ville, et le nombre d'\u00e9tudiants inscrits.</p> <p>Attributes:</p> <ul> <li> <code>name</code>               (<code>str</code>)           \u2013            <p>Le nom de l'\u00e9cole.</p> </li> <li> <code>address</code>               (<code>str</code>)           \u2013            <p>L'adresse compl\u00e8te de l'\u00e9cole.</p> </li> <li> <code>city</code>               (<code>str</code>)           \u2013            <p>La ville o\u00f9 se trouve l'\u00e9cole.</p> </li> <li> <code>postal_code</code>               (<code>str</code>)           \u2013            <p>Le code postal de l'\u00e9cole.</p> </li> <li> <code>phone</code>               (<code>str</code>)           \u2013            <p>Le num\u00e9ro de t\u00e9l\u00e9phone de contact de l'\u00e9cole.</p> </li> <li> <code>students_count</code>               (<code>int</code>)           \u2013            <p>Le nombre d'\u00e9tudiants inscrits.</p> </li> <li> <code>created_at</code>               (<code>datetime</code>)           \u2013            <p>La date de cr\u00e9ation de l'enregistrement.</p> </li> </ul> Source code in <code>ecole/models.py</code> <pre><code>class Ecole(models.Model):\n    \"\"\"Repr\u00e9sente une \u00e9cole dans le syst\u00e8me de gestion.\n\n    Ce mod\u00e8le contient les informations principales d'une \u00e9cole,\n    telles que son nom, son adresse, sa ville, et le nombre d'\u00e9tudiants inscrits.\n\n    Attributes:\n        name (str): Le nom de l'\u00e9cole.\n        address (str): L'adresse compl\u00e8te de l'\u00e9cole.\n        city (str): La ville o\u00f9 se trouve l'\u00e9cole.\n        postal_code (str): Le code postal de l'\u00e9cole.\n        phone (str): Le num\u00e9ro de t\u00e9l\u00e9phone de contact de l'\u00e9cole.\n        students_count (int): Le nombre d'\u00e9tudiants inscrits.\n        created_at (datetime): La date de cr\u00e9ation de l'enregistrement.\n    \"\"\"\n\n    name = models.CharField(max_length=100)\n    address = models.CharField(max_length=255)\n    city = models.CharField(max_length=100)\n    postal_code = models.CharField(max_length=100)\n    phone = models.CharField(max_length=100)\n    students_count = models.PositiveIntegerField(default=0)\n    created_at = models.DateTimeField(auto_now_add=True)\n\n    def __str__(self):\n        \"\"\"Retourne le nom de l'\u00e9cole sous forme de cha\u00eene.\"\"\"\n        return self.name\n</code></pre>"},{"location":"api/ecole/#ecole.models.Ecole.__str__","title":"<code>__str__()</code>","text":"<p>Retourne le nom de l'\u00e9cole sous forme de cha\u00eene.</p> Source code in <code>ecole/models.py</code> <pre><code>def __str__(self):\n    \"\"\"Retourne le nom de l'\u00e9cole sous forme de cha\u00eene.\"\"\"\n    return self.name\n</code></pre>"},{"location":"api/ecole/#2-serialiseurs-ecoleserializers","title":"2. S\u00e9rialiseurs (<code>ecole.serializers</code>)","text":"<ul> <li>Transforme les instances du mod\u00e8le <code>Ecole</code> en JSON et valide les donn\u00e9es entrantes.  </li> <li>Exemple :</li> <li><code>EcoleSerializer</code> : s\u00e9rialiseur principal pour cr\u00e9er et mettre \u00e0 jour les \u00e9coles.  </li> </ul> <p>               Bases: <code>ModelSerializer</code></p> <p>Le EcoleSerializer g\u00e8re la s\u00e9rialisation/d\u00e9s\u00e9rialisation des donn\u00e9es et la validation des champs.</p> <p>Ce s\u00e9rialiseur g\u00e8re la conversion des instances du mod\u00e8le Ecole en JSON et vice-versa pour les op\u00e9rations CRUD via l'API REST.</p> <p>Attributes:</p> <ul> <li> <code>name</code>               (<code>str</code>)           \u2013            <p>Nom de l'\u00e9cole (requis, max 255 caract\u00e8res).</p> </li> <li> <code>address</code>               (<code>str</code>)           \u2013            <p>Adresse compl\u00e8te de l'\u00e9cole (requis).</p> </li> <li> <code>city</code>               (<code>str</code>)           \u2013            <p>Ville o\u00f9 se situe l'\u00e9cole (requis, max 100 caract\u00e8res).</p> </li> <li> <code>postal_code</code>               (<code>str</code>)           \u2013            <p>Code postal de l'\u00e9cole (requis, format: 4 chiffres).</p> </li> <li> <code>phone</code>               (<code>str</code>)           \u2013            <p>Num\u00e9ro de t\u00e9l\u00e9phone au format international (requis).</p> </li> <li> <code>students_count</code>               (<code>int</code>)           \u2013            <p>Nombre total d'\u00e9tudiants inscrits (lecture seule).</p> </li> </ul> Validation <ul> <li>Le nom de l'\u00e9cole doit \u00eatre unique.</li> <li>Le code postal doit contenir exactement 4 chiffres.</li> <li>Le num\u00e9ro de t\u00e9l\u00e9phone doit suivre le format international (+216...).</li> </ul> Source code in <code>ecole/serializers.py</code> <pre><code>class EcoleSerializer(serializers.ModelSerializer):\n    \"\"\"\n    Le EcoleSerializer g\u00e8re la s\u00e9rialisation/d\u00e9s\u00e9rialisation des donn\u00e9es et la validation des champs.\n\n    Ce s\u00e9rialiseur g\u00e8re la conversion des instances du mod\u00e8le Ecole en JSON\n    et vice-versa pour les op\u00e9rations CRUD via l'API REST.\n\n    Attributes:\n        name (str): Nom de l'\u00e9cole (requis, max 255 caract\u00e8res).\n        address (str): Adresse compl\u00e8te de l'\u00e9cole (requis).\n        city (str): Ville o\u00f9 se situe l'\u00e9cole (requis, max 100 caract\u00e8res).\n        postal_code (str): Code postal de l'\u00e9cole (requis, format: 4 chiffres).\n        phone (str): Num\u00e9ro de t\u00e9l\u00e9phone au format international (requis).\n        students_count (int): Nombre total d'\u00e9tudiants inscrits (lecture seule).\n\n    Validation:\n        - Le nom de l'\u00e9cole doit \u00eatre unique.\n        - Le code postal doit contenir exactement 4 chiffres.\n        - Le num\u00e9ro de t\u00e9l\u00e9phone doit suivre le format international (+216...).\n\n\"\"\"\n\n\n    # Champ calcul\u00e9 en lecture seule\n    students_count = serializers.IntegerField(read_only=True)\n\n    class Meta:\n        model = Ecole\n        fields = ('id', 'name', 'address', 'city', 'postal_code', 'phone', 'students_count')\n        read_only_fields = ('id', 'students_count')\n\n    def validate_postal_code(self, value):\n        \"\"\"\n        Valide le format du code postal tunisien.\n\n        Args:\n            value (str): Le code postal \u00e0 valider.\n\n        Returns:\n            str: Le code postal valid\u00e9.\n\n        Raises:\n            ValidationError: Si le code postal n'est pas compos\u00e9 de 4 chiffres.\n        \"\"\"\n        if not re.match(r'^\\d{4}$', value):\n            raise serializers.ValidationError(\n                \"Le code postal doit contenir exactement 4 chiffres.\"\n            )\n        return value\n\n    def validate_phone(self, value):\n        \"\"\"\n        Valide le format du num\u00e9ro de t\u00e9l\u00e9phone.\n\n        Args:\n            value (str): Le num\u00e9ro de t\u00e9l\u00e9phone \u00e0 valider.\n\n        Returns:\n            str: Le num\u00e9ro de t\u00e9l\u00e9phone valid\u00e9.\n\n        Raises:\n            ValidationError: Si le format du t\u00e9l\u00e9phone est invalide.\n        \"\"\"\n        # Format attendu: +216 XX XXX XXX\n        phone_pattern = r'^\\+216\\s?\\d{2}\\s?\\d{3}\\s?\\d{3,4}$'\n        if not re.match(phone_pattern, value):\n            raise serializers.ValidationError(\n                \"Le num\u00e9ro de t\u00e9l\u00e9phone doit \u00eatre au format international (+216 XX XXX XXX).\"\n            )\n        return value\n\n    def validate_name(self, value):\n        \"\"\"\n        Valide le nom de l'\u00e9cole.\n\n        Args:\n            value (str): Le nom de l'\u00e9cole \u00e0 valider.\n\n        Returns:\n            str: Le nom valid\u00e9.\n\n        Raises:\n            ValidationError: Si le nom est trop court.\n        \"\"\"\n        if len(value.strip()) &lt; 3:\n            raise serializers.ValidationError(\n                \"Le nom de l'\u00e9cole doit contenir au moins 3 caract\u00e8res.\"\n            )\n        return value.strip()\n\n    def validate(self, data):\n        \"\"\"\n        Validation globale des donn\u00e9es de l'\u00e9cole.\n\n        Args:\n            data (dict): Donn\u00e9es \u00e0 valider.\n\n        Returns:\n            dict: Donn\u00e9es valid\u00e9es.\n\n        Raises:\n            ValidationError: Si les donn\u00e9es ne sont pas coh\u00e9rentes.\n        \"\"\"\n        # Validation suppl\u00e9mentaire si n\u00e9cessaire\n        return data\n\n    def create(self, validated_data):\n        \"\"\"\n        Cr\u00e9e et retourne une nouvelle instance d'Ecole.\n\n        Args:\n            validated_data (dict): Donn\u00e9es valid\u00e9es pour cr\u00e9er l'\u00e9cole.\n\n        Returns:\n            Ecole: L'instance de l'\u00e9cole cr\u00e9\u00e9e.\n        \"\"\"\n        return Ecole.objects.create(**validated_data)\n\n    def update(self, instance, validated_data):\n        \"\"\"\n        Met \u00e0 jour et retourne une instance d'Ecole existante.\n\n        Args:\n            instance (Ecole): L'instance existante \u00e0 mettre \u00e0 jour.\n            validated_data (dict): Nouvelles donn\u00e9es valid\u00e9es.\n\n        Returns:\n            Ecole: L'instance mise \u00e0 jour.\n        \"\"\"\n        instance.name = validated_data.get('name', instance.name)\n        instance.address = validated_data.get('address', instance.address)\n        instance.city = validated_data.get('city', instance.city)\n        instance.postal_code = validated_data.get('postal_code', instance.postal_code)\n        instance.phone = validated_data.get('phone', instance.phone)\n        instance.save()\n        return instance\n</code></pre>"},{"location":"api/ecole/#ecole.serializers.EcoleSerializer.create","title":"<code>create(validated_data)</code>","text":"<p>Cr\u00e9e et retourne une nouvelle instance d'Ecole.</p> <p>Parameters:</p> <ul> <li> <code>validated_data</code>               (<code>dict</code>)           \u2013            <p>Donn\u00e9es valid\u00e9es pour cr\u00e9er l'\u00e9cole.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>Ecole</code>          \u2013            <p>L'instance de l'\u00e9cole cr\u00e9\u00e9e.</p> </li> </ul> Source code in <code>ecole/serializers.py</code> <pre><code>def create(self, validated_data):\n    \"\"\"\n    Cr\u00e9e et retourne une nouvelle instance d'Ecole.\n\n    Args:\n        validated_data (dict): Donn\u00e9es valid\u00e9es pour cr\u00e9er l'\u00e9cole.\n\n    Returns:\n        Ecole: L'instance de l'\u00e9cole cr\u00e9\u00e9e.\n    \"\"\"\n    return Ecole.objects.create(**validated_data)\n</code></pre>"},{"location":"api/ecole/#ecole.serializers.EcoleSerializer.update","title":"<code>update(instance, validated_data)</code>","text":"<p>Met \u00e0 jour et retourne une instance d'Ecole existante.</p> <p>Parameters:</p> <ul> <li> <code>instance</code>               (<code>Ecole</code>)           \u2013            <p>L'instance existante \u00e0 mettre \u00e0 jour.</p> </li> <li> <code>validated_data</code>               (<code>dict</code>)           \u2013            <p>Nouvelles donn\u00e9es valid\u00e9es.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>Ecole</code>          \u2013            <p>L'instance mise \u00e0 jour.</p> </li> </ul> Source code in <code>ecole/serializers.py</code> <pre><code>def update(self, instance, validated_data):\n    \"\"\"\n    Met \u00e0 jour et retourne une instance d'Ecole existante.\n\n    Args:\n        instance (Ecole): L'instance existante \u00e0 mettre \u00e0 jour.\n        validated_data (dict): Nouvelles donn\u00e9es valid\u00e9es.\n\n    Returns:\n        Ecole: L'instance mise \u00e0 jour.\n    \"\"\"\n    instance.name = validated_data.get('name', instance.name)\n    instance.address = validated_data.get('address', instance.address)\n    instance.city = validated_data.get('city', instance.city)\n    instance.postal_code = validated_data.get('postal_code', instance.postal_code)\n    instance.phone = validated_data.get('phone', instance.phone)\n    instance.save()\n    return instance\n</code></pre>"},{"location":"api/ecole/#ecole.serializers.EcoleSerializer.validate","title":"<code>validate(data)</code>","text":"<p>Validation globale des donn\u00e9es de l'\u00e9cole.</p> <p>Parameters:</p> <ul> <li> <code>data</code>               (<code>dict</code>)           \u2013            <p>Donn\u00e9es \u00e0 valider.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>dict</code>          \u2013            <p>Donn\u00e9es valid\u00e9es.</p> </li> </ul> <p>Raises:</p> <ul> <li> <code>ValidationError</code>             \u2013            <p>Si les donn\u00e9es ne sont pas coh\u00e9rentes.</p> </li> </ul> Source code in <code>ecole/serializers.py</code> <pre><code>def validate(self, data):\n    \"\"\"\n    Validation globale des donn\u00e9es de l'\u00e9cole.\n\n    Args:\n        data (dict): Donn\u00e9es \u00e0 valider.\n\n    Returns:\n        dict: Donn\u00e9es valid\u00e9es.\n\n    Raises:\n        ValidationError: Si les donn\u00e9es ne sont pas coh\u00e9rentes.\n    \"\"\"\n    # Validation suppl\u00e9mentaire si n\u00e9cessaire\n    return data\n</code></pre>"},{"location":"api/ecole/#ecole.serializers.EcoleSerializer.validate_name","title":"<code>validate_name(value)</code>","text":"<p>Valide le nom de l'\u00e9cole.</p> <p>Parameters:</p> <ul> <li> <code>value</code>               (<code>str</code>)           \u2013            <p>Le nom de l'\u00e9cole \u00e0 valider.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>str</code>          \u2013            <p>Le nom valid\u00e9.</p> </li> </ul> <p>Raises:</p> <ul> <li> <code>ValidationError</code>             \u2013            <p>Si le nom est trop court.</p> </li> </ul> Source code in <code>ecole/serializers.py</code> <pre><code>def validate_name(self, value):\n    \"\"\"\n    Valide le nom de l'\u00e9cole.\n\n    Args:\n        value (str): Le nom de l'\u00e9cole \u00e0 valider.\n\n    Returns:\n        str: Le nom valid\u00e9.\n\n    Raises:\n        ValidationError: Si le nom est trop court.\n    \"\"\"\n    if len(value.strip()) &lt; 3:\n        raise serializers.ValidationError(\n            \"Le nom de l'\u00e9cole doit contenir au moins 3 caract\u00e8res.\"\n        )\n    return value.strip()\n</code></pre>"},{"location":"api/ecole/#ecole.serializers.EcoleSerializer.validate_phone","title":"<code>validate_phone(value)</code>","text":"<p>Valide le format du num\u00e9ro de t\u00e9l\u00e9phone.</p> <p>Parameters:</p> <ul> <li> <code>value</code>               (<code>str</code>)           \u2013            <p>Le num\u00e9ro de t\u00e9l\u00e9phone \u00e0 valider.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>str</code>          \u2013            <p>Le num\u00e9ro de t\u00e9l\u00e9phone valid\u00e9.</p> </li> </ul> <p>Raises:</p> <ul> <li> <code>ValidationError</code>             \u2013            <p>Si le format du t\u00e9l\u00e9phone est invalide.</p> </li> </ul> Source code in <code>ecole/serializers.py</code> <pre><code>def validate_phone(self, value):\n    \"\"\"\n    Valide le format du num\u00e9ro de t\u00e9l\u00e9phone.\n\n    Args:\n        value (str): Le num\u00e9ro de t\u00e9l\u00e9phone \u00e0 valider.\n\n    Returns:\n        str: Le num\u00e9ro de t\u00e9l\u00e9phone valid\u00e9.\n\n    Raises:\n        ValidationError: Si le format du t\u00e9l\u00e9phone est invalide.\n    \"\"\"\n    # Format attendu: +216 XX XXX XXX\n    phone_pattern = r'^\\+216\\s?\\d{2}\\s?\\d{3}\\s?\\d{3,4}$'\n    if not re.match(phone_pattern, value):\n        raise serializers.ValidationError(\n            \"Le num\u00e9ro de t\u00e9l\u00e9phone doit \u00eatre au format international (+216 XX XXX XXX).\"\n        )\n    return value\n</code></pre>"},{"location":"api/ecole/#ecole.serializers.EcoleSerializer.validate_postal_code","title":"<code>validate_postal_code(value)</code>","text":"<p>Valide le format du code postal tunisien.</p> <p>Parameters:</p> <ul> <li> <code>value</code>               (<code>str</code>)           \u2013            <p>Le code postal \u00e0 valider.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>str</code>          \u2013            <p>Le code postal valid\u00e9.</p> </li> </ul> <p>Raises:</p> <ul> <li> <code>ValidationError</code>             \u2013            <p>Si le code postal n'est pas compos\u00e9 de 4 chiffres.</p> </li> </ul> Source code in <code>ecole/serializers.py</code> <pre><code>def validate_postal_code(self, value):\n    \"\"\"\n    Valide le format du code postal tunisien.\n\n    Args:\n        value (str): Le code postal \u00e0 valider.\n\n    Returns:\n        str: Le code postal valid\u00e9.\n\n    Raises:\n        ValidationError: Si le code postal n'est pas compos\u00e9 de 4 chiffres.\n    \"\"\"\n    if not re.match(r'^\\d{4}$', value):\n        raise serializers.ValidationError(\n            \"Le code postal doit contenir exactement 4 chiffres.\"\n        )\n    return value\n</code></pre>"},{"location":"api/ecole/#3-vues-ecoleviews","title":"3. Vues (<code>ecole.views</code>)","text":"<ul> <li>Les vues utilisent les d\u00e9corateurs DRF pour g\u00e9rer authentification, permissions et routing.  </li> <li>Endpoints principaux :</li> </ul> Vue Description <code>ecole_list_create</code> Liste toutes les \u00e9coles ou cr\u00e9e une nouvelle \u00e9cole <code>ecole_detail</code> D\u00e9tails, modification ou suppression d\u2019une \u00e9cole <p>Liste et cr\u00e9ation d'\u00e9coles.</p> <p>Consultation, mise \u00e0 jour ou suppression d'une \u00e9cole sp\u00e9cifique.</p>"},{"location":"api/ecole/#ecole.views.ecole_list_create--methodes-disponibles","title":"M\u00e9thodes disponibles :","text":"<ul> <li>GET : R\u00e9cup\u00e8re la liste de toutes les \u00e9coles.</li> <li>POST : Cr\u00e9e une nouvelle \u00e9cole (r\u00e9serv\u00e9 aux administrateurs).</li> </ul>"},{"location":"api/ecole/#ecole.views.ecole_list_create--conditions-dacces","title":"Conditions d'acc\u00e8s :","text":"<ul> <li>L'utilisateur doit \u00eatre authentifi\u00e9.</li> <li>La cr\u00e9ation (<code>POST</code>) n\u00e9cessite que l'utilisateur soit administrateur (<code>is_staff=True</code> ou <code>role='admin'</code>).</li> </ul>"},{"location":"api/ecole/#ecole.views.ecole_list_create--reponses","title":"R\u00e9ponses :","text":"<ul> <li>200 OK : Retourne la liste des \u00e9coles (GET).</li> <li>201 CREATED : Retourne les d\u00e9tails de l\u2019\u00e9cole cr\u00e9\u00e9e (POST r\u00e9ussi).</li> <li>403 FORBIDDEN : Si un utilisateur non-admin tente de cr\u00e9er une \u00e9cole.</li> <li>400 BAD REQUEST : Si les donn\u00e9es fournies sont invalides.</li> </ul>"},{"location":"api/ecole/#ecole.views.ecole_list_create--exemple-de-requete-post","title":"Exemple de requ\u00eate POST :","text":"<pre><code>{\n    \"name\": \"\u00c9cole Nationale d'Informatique\",\n    \"address\": \"Route de Tunis\",\n    \"city\": \"Sousse\",\n    \"postal_code\": \"4000\",\n    \"phone\": \"+216 73 123 456\"\n}\n</code></pre>"},{"location":"api/ecole/#ecole.views.ecole_list_create--exemple-de-reponse-get","title":"Exemple de r\u00e9ponse (GET) :","text":"<pre><code>[\n    {\n        \"id\": 1,\n        \"name\": \"\u00c9cole Nationale d'Informatique\",\n        \"address\": \"Route de Tunis\",\n        \"city\": \"Sousse\",\n        \"postal_code\": \"4000\",\n        \"phone\": \"+216 73 123 456\",\n        \"students_count\": 250,\n        \"created_at\": \"2025-11-07T09:12:34Z\"\n    }\n]\n</code></pre> Source code in <code>ecole/views.py</code> <pre><code>@api_view(['GET', 'POST'])\n@permission_classes([permissions.IsAuthenticated])\ndef ecole_list_create(request):\n    \"\"\"\n    Liste et cr\u00e9ation d'\u00e9coles.\n\n    ### M\u00e9thodes disponibles :\n    - **GET** : R\u00e9cup\u00e8re la liste de toutes les \u00e9coles.\n    - **POST** : Cr\u00e9e une nouvelle \u00e9cole (r\u00e9serv\u00e9 aux administrateurs).\n\n    ### Conditions d'acc\u00e8s :\n    - L'utilisateur doit \u00eatre authentifi\u00e9.\n    - La cr\u00e9ation (`POST`) n\u00e9cessite que l'utilisateur soit administrateur (`is_staff=True` ou `role='admin'`).\n\n    ### R\u00e9ponses :\n    - **200 OK** : Retourne la liste des \u00e9coles (GET).\n    - **201 CREATED** : Retourne les d\u00e9tails de l\u2019\u00e9cole cr\u00e9\u00e9e (POST r\u00e9ussi).\n    - **403 FORBIDDEN** : Si un utilisateur non-admin tente de cr\u00e9er une \u00e9cole.\n    - **400 BAD REQUEST** : Si les donn\u00e9es fournies sont invalides.\n\n    ### Exemple de requ\u00eate POST :\n    ```json\n    {\n        \"name\": \"\u00c9cole Nationale d'Informatique\",\n        \"address\": \"Route de Tunis\",\n        \"city\": \"Sousse\",\n        \"postal_code\": \"4000\",\n        \"phone\": \"+216 73 123 456\"\n    }\n    ```\n\n    ### Exemple de r\u00e9ponse (GET) :\n    ```json\n    [\n        {\n            \"id\": 1,\n            \"name\": \"\u00c9cole Nationale d'Informatique\",\n            \"address\": \"Route de Tunis\",\n            \"city\": \"Sousse\",\n            \"postal_code\": \"4000\",\n            \"phone\": \"+216 73 123 456\",\n            \"students_count\": 250,\n            \"created_at\": \"2025-11-07T09:12:34Z\"\n        }\n    ]\n    ```\n    \"\"\"\n    if request.method == 'GET':\n        ecoles = Ecole.objects.all()\n        serializer = EcoleSerializer(ecoles, many=True)\n        return Response(serializer.data)\n\n    elif request.method == 'POST':\n        if not request.user.is_staff and getattr(request.user, \"role\", \"\") != 'admin':\n            return Response(\n                {\"error\": \"Seul un administrateur peut cr\u00e9er une \u00e9cole.\"},\n                status=status.HTTP_403_FORBIDDEN\n            )\n        serializer = EcoleSerializer(data=request.data)\n        if serializer.is_valid():\n            serializer.save()\n            return Response(serializer.data, status=status.HTTP_201_CREATED)\n        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n</code></pre>"},{"location":"api/ecole/#ecole.views.ecole_detail--methodes-disponibles","title":"M\u00e9thodes disponibles :","text":"<ul> <li>GET : R\u00e9cup\u00e8re les d\u00e9tails d\u2019une \u00e9cole sp\u00e9cifique.</li> <li>PUT : Met \u00e0 jour les informations d\u2019une \u00e9cole (r\u00e9serv\u00e9 aux administrateurs).</li> <li>DELETE : Supprime une \u00e9cole (r\u00e9serv\u00e9 aux administrateurs).</li> </ul>"},{"location":"api/ecole/#ecole.views.ecole_detail--parametres","title":"Param\u00e8tres :","text":"<ul> <li><code>pk</code> (int) : Identifiant unique de l\u2019\u00e9cole.</li> </ul>"},{"location":"api/ecole/#ecole.views.ecole_detail--conditions-dacces","title":"Conditions d'acc\u00e8s :","text":"<ul> <li>L'utilisateur doit \u00eatre authentifi\u00e9.</li> <li>Les op\u00e9rations PUT et DELETE sont r\u00e9serv\u00e9es aux administrateurs.</li> </ul>"},{"location":"api/ecole/#ecole.views.ecole_detail--reponses","title":"R\u00e9ponses :","text":"<ul> <li>200 OK : Retourne les d\u00e9tails de l\u2019\u00e9cole (GET ou PUT r\u00e9ussi).</li> <li>204 NO CONTENT : Confirme la suppression r\u00e9ussie.</li> <li>403 FORBIDDEN : Si un utilisateur non-admin tente de modifier/supprimer.</li> <li>404 NOT FOUND : Si l\u2019\u00e9cole demand\u00e9e n\u2019existe pas.</li> <li>400 BAD REQUEST : Si les donn\u00e9es envoy\u00e9es lors de la mise \u00e0 jour sont invalides.</li> </ul>"},{"location":"api/ecole/#ecole.views.ecole_detail--exemple-de-reponse-get","title":"Exemple de r\u00e9ponse (GET) :","text":"<pre><code>{\n    \"id\": 2,\n    \"name\": \"Institut Sup\u00e9rieur de Technologie\",\n    \"address\": \"Avenue de la R\u00e9publique\",\n    \"city\": \"Tunis\",\n    \"postal_code\": \"1002\",\n    \"phone\": \"+216 71 456 789\",\n    \"students_count\": 120,\n    \"created_at\": \"2025-10-30T14:30:00Z\"\n}\n</code></pre> Source code in <code>ecole/views.py</code> <pre><code>@api_view(['GET', 'PUT', 'DELETE'])\n@permission_classes([permissions.IsAuthenticated])\ndef ecole_detail(request, pk):\n    \"\"\"\n    Consultation, mise \u00e0 jour ou suppression d'une \u00e9cole sp\u00e9cifique.\n\n    ### M\u00e9thodes disponibles :\n    - **GET** : R\u00e9cup\u00e8re les d\u00e9tails d\u2019une \u00e9cole sp\u00e9cifique.\n    - **PUT** : Met \u00e0 jour les informations d\u2019une \u00e9cole (r\u00e9serv\u00e9 aux administrateurs).\n    - **DELETE** : Supprime une \u00e9cole (r\u00e9serv\u00e9 aux administrateurs).\n\n    ### Param\u00e8tres :\n    - `pk` *(int)* : Identifiant unique de l\u2019\u00e9cole.\n\n    ### Conditions d'acc\u00e8s :\n    - L'utilisateur doit \u00eatre authentifi\u00e9.\n    - Les op\u00e9rations PUT et DELETE sont r\u00e9serv\u00e9es aux administrateurs.\n\n    ### R\u00e9ponses :\n    - **200 OK** : Retourne les d\u00e9tails de l\u2019\u00e9cole (GET ou PUT r\u00e9ussi).\n    - **204 NO CONTENT** : Confirme la suppression r\u00e9ussie.\n    - **403 FORBIDDEN** : Si un utilisateur non-admin tente de modifier/supprimer.\n    - **404 NOT FOUND** : Si l\u2019\u00e9cole demand\u00e9e n\u2019existe pas.\n    - **400 BAD REQUEST** : Si les donn\u00e9es envoy\u00e9es lors de la mise \u00e0 jour sont invalides.\n\n    ### Exemple de r\u00e9ponse (GET) :\n    ```json\n    {\n        \"id\": 2,\n        \"name\": \"Institut Sup\u00e9rieur de Technologie\",\n        \"address\": \"Avenue de la R\u00e9publique\",\n        \"city\": \"Tunis\",\n        \"postal_code\": \"1002\",\n        \"phone\": \"+216 71 456 789\",\n        \"students_count\": 120,\n        \"created_at\": \"2025-10-30T14:30:00Z\"\n    }\n    ```\n    \"\"\"\n    try:\n        ecole = Ecole.objects.get(pk=pk)\n    except Ecole.DoesNotExist:\n        return Response({'error': '\u00c9cole non trouv\u00e9e'}, status=status.HTTP_404_NOT_FOUND)\n\n    if request.method == 'GET':\n        serializer = EcoleSerializer(ecole)\n        return Response(serializer.data)\n\n    elif request.method == 'PUT':\n        if not request.user.is_staff and getattr(request.user, \"role\", \"\") != 'admin':\n            return Response(\n                {\"error\": \"Seul un administrateur peut modifier une \u00e9cole.\"},\n                status=status.HTTP_403_FORBIDDEN\n            )\n        serializer = EcoleSerializer(ecole, data=request.data)\n        if serializer.is_valid():\n            serializer.save()\n            return Response(serializer.data)\n        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n\n    elif request.method == 'DELETE':\n        if not request.user.is_staff and getattr(request.user, \"role\", \"\") != 'admin':\n            return Response(\n                {\"error\": \"Seul un administrateur peut supprimer une \u00e9cole.\"},\n                status=status.HTTP_403_FORBIDDEN\n            )\n        ecole.delete()\n        return Response({'message': '\u00c9cole supprim\u00e9e avec succ\u00e8s'}, status=status.HTTP_204_NO_CONTENT)\n</code></pre>"},{"location":"api/ecole/#4-urls-ecoleurls","title":"4. URLs (<code>ecole.urls</code>)","text":"<ul> <li>Configure le routing API pour le module Ecole.  </li> <li>Routes disponibles :</li> </ul> M\u00e9thode HTTP Endpoint Description Permission requise GET /api/ecoles/ Liste toutes les \u00e9coles Utilisateur authentifi\u00e9 POST /api/ecoles/ Cr\u00e9e une nouvelle \u00e9cole Administrateur GET /api/ecoles/{id}/ D\u00e9tails d'une \u00e9cole Utilisateur authentifi\u00e9 PUT /api/ecoles/{id}/ Modifie une \u00e9cole compl\u00e8te Administrateur PATCH /api/ecoles/{id}/ Modification partielle Administrateur DELETE /api/ecoles/{id}/ Supprime une \u00e9cole Administrateur <p>D\u00e9finition des routes de l'application users li\u00e9es \u00e0 la gestion des \u00e9coles.</p>"},{"location":"api/ecole/#ecole.urls--details-des-endpoints","title":"D\u00e9tails des Endpoints :","text":""},{"location":"api/ecole/#ecole.urls--get-ecoles","title":"\ud83d\udd39 <code>GET /ecoles/</code>","text":"<ul> <li>Description : R\u00e9cup\u00e8re la liste de toutes les \u00e9coles.</li> <li>Acc\u00e8s : Utilisateurs authentifi\u00e9s.</li> <li>R\u00e9ponse (200) :</li> </ul> <pre><code>  [\n    {\n      \"id\": 1,\n      \"name\": \"\u00c9cole Nationale d'Informatique\",\n      \"address\": \"Route de Tunis\",\n      \"city\": \"Sousse\",\n      \"postal_code\": \"4000\",\n      \"phone\": \"+216 73 123 456\",\n      \"students_count\": 250,\n      \"created_at\": \"2025-11-07T09:12:34Z\"\n    }\n  ]\n</code></pre>"},{"location":"api/ecole/#ecole.urls--post-ecoles","title":"\ud83d\udd39 <code>POST /ecoles/</code>","text":"<ul> <li>Description : Cr\u00e9e une nouvelle \u00e9cole.</li> <li>Acc\u00e8s : R\u00e9serv\u00e9 aux administrateurs.</li> <li>Exemple de requ\u00eate :</li> </ul> <pre><code>  {\n    \"name\": \"Institut Sup\u00e9rieur de Technologie\",\n    \"address\": \"Avenue de la R\u00e9publique\",\n    \"city\": \"Tunis\",\n    \"postal_code\": \"1002\",\n    \"phone\": \"+216 71 456 789\"\n  }\n</code></pre> <ul> <li>R\u00e9ponse (201) : D\u00e9tails de l'\u00e9cole cr\u00e9\u00e9e.</li> </ul>"},{"location":"api/ecole/#ecole.urls--get-ecolesintpk","title":"\ud83d\udd39 <code>GET /ecoles/&lt;int:pk&gt;/</code>","text":"<ul> <li>Description : R\u00e9cup\u00e8re les informations d'une \u00e9cole sp\u00e9cifique.</li> <li>Acc\u00e8s : Utilisateurs authentifi\u00e9s.</li> </ul>"},{"location":"api/ecole/#ecole.urls--put-ecolesintpk","title":"\ud83d\udd39 <code>PUT /ecoles/&lt;int:pk&gt;/</code>","text":"<ul> <li>Description : Met \u00e0 jour les informations d'une \u00e9cole existante.</li> <li>Acc\u00e8s : R\u00e9serv\u00e9 aux administrateurs.</li> </ul>"},{"location":"api/ecole/#ecole.urls--delete-ecolesintpk","title":"\ud83d\udd39 <code>DELETE /ecoles/&lt;int:pk&gt;/</code>","text":"<ul> <li>Description : Supprime une \u00e9cole.</li> <li>Acc\u00e8s : R\u00e9serv\u00e9 aux administrateurs.</li> </ul>"},{"location":"api/ecole/#5-tests-ecoletests","title":"5. Tests (<code>ecole.tests</code>)","text":"<ul> <li>Suite de tests unitaires compl\u00e8te couvrant toutes les op\u00e9rations CRUD avec diff\u00e9rents niveaux de permissions.  </li> <li>V\u00e9rifie les sc\u00e9narios de succ\u00e8s et d\u2019\u00e9chec selon le r\u00f4le de l\u2019utilisateur (admin ou standard).  </li> </ul>"},{"location":"api/ecole/#51-tableau-recapitulatif-des-tests-crud","title":"5.1. Tableau r\u00e9capitulatif des tests CRUD","text":"Test M\u00e9thode R\u00f4le R\u00e9sultat attendu <code>test_get_ecole_list_authenticated</code> GET user 200 OK <code>test_get_ecole_list_unauthenticated</code> GET anonyme 401/403 <code>test_get_ecole_detail_authenticated</code> GET user 200 OK <code>test_post_ecole_admin</code> POST admin 201 Created <code>test_post_ecole_non_admin</code> POST user 403 Forbidden <code>test_put_ecole_admin</code> PUT admin 200 OK <code>test_put_ecole_non_admin</code> PUT user 403 Forbidden <code>test_delete_ecole_admin</code> DELETE admin 204 No Content <code>test_delete_ecole_non_admin</code> DELETE user 403 Forbidden"},{"location":"api/ecole/#52-notes-sur-les-tests","title":"5.2. Notes sur les tests","text":"<ul> <li>Les tests v\u00e9rifient l\u2019authentification, les permissions et les r\u00e9ponses HTTP pour chaque endpoint.  </li> <li>Permet de garantir que seuls les utilisateurs autoris\u00e9s (admin) peuvent cr\u00e9er, modifier ou supprimer une \u00e9cole, tandis que les utilisateurs standards ne peuvent que consulter les donn\u00e9es.</li> </ul>"},{"location":"api/files/","title":"Module Files","text":"<p>Le module <code>files</code> g\u00e8re l'upload, le stockage et la gestion des fichiers associ\u00e9s aux \u00e9coles. Il fournit : mod\u00e8les, s\u00e9rialiseurs, vues API, utilitaires, validateurs et tests complets.</p>"},{"location":"api/files/#1-modeles","title":"1. Mod\u00e8les","text":""},{"location":"api/files/#11-fichier-principal","title":"1.1 Fichier principal","text":"<p>               Bases: <code>Model</code></p> <p>Mod\u00e8le repr\u00e9sentant un fichier upload\u00e9 dans le syst\u00e8me.</p> <p>Attributes:</p> <ul> <li> <code>ecole</code>               (<code>ForeignKey</code>)           \u2013            <p>L'\u00e9cole \u00e0 laquelle le fichier est associ\u00e9.</p> </li> <li> <code>uploaded_by</code>               (<code>ForeignKey</code>)           \u2013            <p>L'utilisateur ayant upload\u00e9 le fichier.</p> </li> <li> <code>file</code>               (<code>FileField</code>)           \u2013            <p>Le fichier upload\u00e9.</p> </li> <li> <code>filename</code>               (<code>str</code>)           \u2013            <p>Nom du fichier.</p> </li> <li> <code>file_type</code>               (<code>str</code>)           \u2013            <p>Type du fichier (pdf, image, document, etc.).</p> </li> <li> <code>file_size</code>               (<code>int</code>)           \u2013            <p>Taille du fichier en octets.</p> </li> <li> <code>mime_type</code>               (<code>str</code>)           \u2013            <p>Type MIME du fichier.</p> </li> <li> <code>description</code>               (<code>str</code>)           \u2013            <p>Description optionnelle du fichier.</p> </li> <li> <code>uploaded_at</code>               (<code>datetime</code>)           \u2013            <p>Date et heure de l'upload.</p> </li> <li> <code>updated_at</code>               (<code>datetime</code>)           \u2013            <p>Date et heure de la derni\u00e8re modification.</p> </li> </ul> Source code in <code>files/models.py</code> <pre><code>class File(models.Model):\n    \"\"\"\n    Mod\u00e8le repr\u00e9sentant un fichier upload\u00e9 dans le syst\u00e8me.\n\n    Attributes:\n        ecole (ForeignKey): L'\u00e9cole \u00e0 laquelle le fichier est associ\u00e9.\n        uploaded_by (ForeignKey): L'utilisateur ayant upload\u00e9 le fichier.\n        file (FileField): Le fichier upload\u00e9.\n        filename (str): Nom du fichier.\n        file_type (str): Type du fichier (pdf, image, document, etc.).\n        file_size (int): Taille du fichier en octets.\n        mime_type (str): Type MIME du fichier.\n        description (str): Description optionnelle du fichier.\n        uploaded_at (datetime): Date et heure de l'upload.\n        updated_at (datetime): Date et heure de la derni\u00e8re modification.\n    \"\"\"\n\n    FILE_TYPES = [\n        ('pdf', 'PDF'),\n        ('image', 'Image'),\n        ('document', 'Document'),\n        ('spreadsheet', 'Tableur'),\n        ('text', 'Texte'),\n        ('other', 'Autre'),\n    ]\n\n    # Relations\n    ecole = models.ForeignKey(\n        Ecole,\n        on_delete=models.CASCADE,\n        related_name='files',\n        verbose_name=\"\u00c9cole\"\n    )\n    uploaded_by = models.ForeignKey(\n        settings.AUTH_USER_MODEL,\n        on_delete=models.CASCADE,\n        related_name='files'\n    )\n\n    # Champs fichier\n    file = models.FileField(\n        upload_to=get_file_path,\n        validators=[validate_file_size, validate_file_extension],\n        verbose_name=\"Fichier\"\n    )\n\n    # M\u00e9tadonn\u00e9es\n    filename = models.CharField(max_length=255, verbose_name=\"Nom du fichier\")\n    file_type = models.CharField(max_length=20, choices=FILE_TYPES, default='other')\n    file_size = models.IntegerField(verbose_name=\"Taille (octets)\")\n    mime_type = models.CharField(max_length=100, blank=True)\n    description = models.TextField(blank=True, verbose_name=\"Description\")\n\n    # Timestamps\n    uploaded_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n\n    class Meta:\n        \"\"\"Options Meta pour le mod\u00e8le File.\"\"\"\n        verbose_name = \"Fichier\"\n        verbose_name_plural = \"Fichiers\"\n        ordering = ['-uploaded_at']\n        indexes = [\n            models.Index(fields=['ecole', '-uploaded_at']),\n            models.Index(fields=['file_type']),\n        ]\n\n    def __str__(self) -&gt; str:\n        \"\"\"\n        Repr\u00e9sentation en cha\u00eene de caract\u00e8res d'un fichier.\n\n        Returns:\n            str: Nom du fichier suivi du nom de l'\u00e9cole.\n        \"\"\"\n        return f\"{self.filename} - {self.ecole.name}\"\n\n    def save(self, *args, **kwargs):\n        \"\"\"\n        Override de la m\u00e9thode save pour extraire automatiquement les m\u00e9tadonn\u00e9es\n        du fichier upload\u00e9 (nom, taille, type et MIME).\n\n        Args:\n            *args: Arguments positionnels.\n            **kwargs: Arguments nomm\u00e9s.\n        \"\"\"\n        if self.file:\n            self.filename = os.path.basename(self.file.name)\n            self.file_size = self.file.size\n            self.file_type = determine_file_type(self.filename)\n            self.mime_type = get_mime_type(self.filename)\n\n        super().save(*args, **kwargs)\n\n    def delete(self, *args, **kwargs):\n        \"\"\"\n        Override de la m\u00e9thode delete pour supprimer le fichier physique\n        du stockage lors de la suppression de l'objet.\n\n        Args:\n            *args: Arguments positionnels.\n            **kwargs: Arguments nomm\u00e9s.\n        \"\"\"\n        if self.file and os.path.isfile(self.file.path):\n            os.remove(self.file.path)\n        super().delete(*args, **kwargs)\n\n    def get_file_size_display(self) -&gt; str:\n        \"\"\"\n        Retourne la taille du fichier sous une forme lisible par l'utilisateur.\n\n        Returns:\n            str: Taille format\u00e9e (B, KB ou MB).\n        \"\"\"\n        size = self.file_size\n        if size &lt; 1024:\n            return f\"{size} B\"\n        elif size &lt; 1024 * 1024:\n            return f\"{size / 1024:.2f} KB\"\n        else:\n            return f\"{size / (1024 * 1024):.2f} MB\"\n</code></pre> <ul> <li>Repr\u00e9sente un fichier li\u00e9 \u00e0 une \u00e9cole.</li> <li>Champs : <code>file</code>, <code>filename</code>, <code>file_type</code>, <code>file_size</code>, <code>mime_type</code>, <code>description</code>, <code>uploaded_by</code>, <code>ecole</code>.</li> <li>M\u00e9thodes : <ul> <li><code>save()</code> : extraction automatique des m\u00e9tadonn\u00e9es</li> <li><code>delete()</code> : suppression du fichier physique</li> <li><code>get_file_size_display()</code> : retourne la taille format\u00e9e</li> </ul> </li> </ul>"},{"location":"api/files/#files.models.File.Meta","title":"<code>Meta</code>","text":"<p>Options Meta pour le mod\u00e8le File.</p> Source code in <code>files/models.py</code> <pre><code>class Meta:\n    \"\"\"Options Meta pour le mod\u00e8le File.\"\"\"\n    verbose_name = \"Fichier\"\n    verbose_name_plural = \"Fichiers\"\n    ordering = ['-uploaded_at']\n    indexes = [\n        models.Index(fields=['ecole', '-uploaded_at']),\n        models.Index(fields=['file_type']),\n    ]\n</code></pre>"},{"location":"api/files/#files.models.File.__str__","title":"<code>__str__()</code>","text":"<p>Repr\u00e9sentation en cha\u00eene de caract\u00e8res d'un fichier.</p> <p>Returns:</p> <ul> <li> <code>str</code> (              <code>str</code> )          \u2013            <p>Nom du fichier suivi du nom de l'\u00e9cole.</p> </li> </ul> Source code in <code>files/models.py</code> <pre><code>def __str__(self) -&gt; str:\n    \"\"\"\n    Repr\u00e9sentation en cha\u00eene de caract\u00e8res d'un fichier.\n\n    Returns:\n        str: Nom du fichier suivi du nom de l'\u00e9cole.\n    \"\"\"\n    return f\"{self.filename} - {self.ecole.name}\"\n</code></pre>"},{"location":"api/files/#files.models.File.delete","title":"<code>delete(*args, **kwargs)</code>","text":"<p>Override de la m\u00e9thode delete pour supprimer le fichier physique du stockage lors de la suppression de l'objet.</p> <p>Parameters:</p> <ul> <li> <code>*args</code>           \u2013            <p>Arguments positionnels.</p> </li> <li> <code>**kwargs</code>           \u2013            <p>Arguments nomm\u00e9s.</p> </li> </ul> Source code in <code>files/models.py</code> <pre><code>def delete(self, *args, **kwargs):\n    \"\"\"\n    Override de la m\u00e9thode delete pour supprimer le fichier physique\n    du stockage lors de la suppression de l'objet.\n\n    Args:\n        *args: Arguments positionnels.\n        **kwargs: Arguments nomm\u00e9s.\n    \"\"\"\n    if self.file and os.path.isfile(self.file.path):\n        os.remove(self.file.path)\n    super().delete(*args, **kwargs)\n</code></pre>"},{"location":"api/files/#files.models.File.get_file_size_display","title":"<code>get_file_size_display()</code>","text":"<p>Retourne la taille du fichier sous une forme lisible par l'utilisateur.</p> <p>Returns:</p> <ul> <li> <code>str</code> (              <code>str</code> )          \u2013            <p>Taille format\u00e9e (B, KB ou MB).</p> </li> </ul> Source code in <code>files/models.py</code> <pre><code>def get_file_size_display(self) -&gt; str:\n    \"\"\"\n    Retourne la taille du fichier sous une forme lisible par l'utilisateur.\n\n    Returns:\n        str: Taille format\u00e9e (B, KB ou MB).\n    \"\"\"\n    size = self.file_size\n    if size &lt; 1024:\n        return f\"{size} B\"\n    elif size &lt; 1024 * 1024:\n        return f\"{size / 1024:.2f} KB\"\n    else:\n        return f\"{size / (1024 * 1024):.2f} MB\"\n</code></pre>"},{"location":"api/files/#files.models.File.save","title":"<code>save(*args, **kwargs)</code>","text":"<p>Override de la m\u00e9thode save pour extraire automatiquement les m\u00e9tadonn\u00e9es du fichier upload\u00e9 (nom, taille, type et MIME).</p> <p>Parameters:</p> <ul> <li> <code>*args</code>           \u2013            <p>Arguments positionnels.</p> </li> <li> <code>**kwargs</code>           \u2013            <p>Arguments nomm\u00e9s.</p> </li> </ul> Source code in <code>files/models.py</code> <pre><code>def save(self, *args, **kwargs):\n    \"\"\"\n    Override de la m\u00e9thode save pour extraire automatiquement les m\u00e9tadonn\u00e9es\n    du fichier upload\u00e9 (nom, taille, type et MIME).\n\n    Args:\n        *args: Arguments positionnels.\n        **kwargs: Arguments nomm\u00e9s.\n    \"\"\"\n    if self.file:\n        self.filename = os.path.basename(self.file.name)\n        self.file_size = self.file.size\n        self.file_type = determine_file_type(self.filename)\n        self.mime_type = get_mime_type(self.filename)\n\n    super().save(*args, **kwargs)\n</code></pre>"},{"location":"api/files/#2-serialiseurs","title":"2. S\u00e9rialiseurs","text":""},{"location":"api/files/#21-serialiseur-complet","title":"2.1 S\u00e9rialiseur complet","text":"<p>               Bases: <code>ModelSerializer</code></p> <p>S\u00e9rialiseur complet pour le mod\u00e8le <code>File</code>.</p> <p>Fournit toutes les informations d\u00e9taill\u00e9es du fichier, y compris : - Nom de l'utilisateur ayant upload\u00e9 le fichier - Nom de l'\u00e9cole - Taille format\u00e9e - URL compl\u00e8te du fichier</p> Source code in <code>files/serializers.py</code> <pre><code>class FileSerializer(serializers.ModelSerializer):\n    \"\"\"\n    S\u00e9rialiseur complet pour le mod\u00e8le `File`.\n\n    Fournit toutes les informations d\u00e9taill\u00e9es du fichier, y compris :\n    - Nom de l'utilisateur ayant upload\u00e9 le fichier\n    - Nom de l'\u00e9cole\n    - Taille format\u00e9e\n    - URL compl\u00e8te du fichier\n    \"\"\"\n    uploaded_by_username = serializers.CharField(\n        source='uploaded_by.username',\n        read_only=True\n    )\n    ecole_name = serializers.CharField(\n        source='ecole.name',\n        read_only=True\n    )\n    file_size_display = serializers.CharField(\n        source='get_file_size_display',\n        read_only=True\n    )\n    file_url = serializers.SerializerMethodField()\n\n    class Meta:\n        model = File\n        fields = [\n            'id', 'ecole', 'ecole_name', 'file', 'file_url', 'filename',\n            'file_type', 'file_size', 'file_size_display', 'mime_type',\n            'description', 'uploaded_by', 'uploaded_by_username',\n            'uploaded_at', 'updated_at'\n        ]\n        read_only_fields = [\n            'filename', 'file_size', 'file_type', 'mime_type',\n            'uploaded_by', 'uploaded_at', 'updated_at'\n        ]\n\n    def get_file_url(self, obj):\n        \"\"\"\n        Retourne l'URL compl\u00e8te du fichier.\n\n        Args:\n            obj (File): Instance du mod\u00e8le `File`.\n\n        Returns:\n            str | None: URL compl\u00e8te du fichier si disponible, sinon None.\n        \"\"\"\n        request = self.context.get('request')\n        if obj.file and request:\n            return request.build_absolute_uri(obj.file.url)\n        return None\n</code></pre> <ul> <li>S\u00e9rialiseur d\u00e9taill\u00e9 pour CRUD complet.</li> <li>Champs calcul\u00e9s : <code>uploaded_by_username</code>, <code>ecole_name</code>, <code>file_size_display</code>, <code>file_url</code>.</li> </ul>"},{"location":"api/files/#files.serializers.FileSerializer.get_file_url","title":"<code>get_file_url(obj)</code>","text":"<p>Retourne l'URL compl\u00e8te du fichier.</p> <p>Parameters:</p> <ul> <li> <code>obj</code>               (<code>File</code>)           \u2013            <p>Instance du mod\u00e8le <code>File</code>.</p> </li> </ul> <p>Returns:</p> <ul> <li>           \u2013            <p>str | None: URL compl\u00e8te du fichier si disponible, sinon None.</p> </li> </ul> Source code in <code>files/serializers.py</code> <pre><code>def get_file_url(self, obj):\n    \"\"\"\n    Retourne l'URL compl\u00e8te du fichier.\n\n    Args:\n        obj (File): Instance du mod\u00e8le `File`.\n\n    Returns:\n        str | None: URL compl\u00e8te du fichier si disponible, sinon None.\n    \"\"\"\n    request = self.context.get('request')\n    if obj.file and request:\n        return request.build_absolute_uri(obj.file.url)\n    return None\n</code></pre>"},{"location":"api/files/#22-serialiseur-pour-upload","title":"2.2 S\u00e9rialiseur pour upload","text":"<p>               Bases: <code>ModelSerializer</code></p> <p>S\u00e9rialiseur pour l'upload de fichiers.</p> <p>Se limite aux champs n\u00e9cessaires pour cr\u00e9er un nouveau fichier : - ecole - file - description</p> Source code in <code>files/serializers.py</code> <pre><code>class FileUploadSerializer(serializers.ModelSerializer):\n    \"\"\"\n    S\u00e9rialiseur pour l'upload de fichiers.\n\n    Se limite aux champs n\u00e9cessaires pour cr\u00e9er un nouveau fichier :\n    - ecole\n    - file\n    - description\n    \"\"\"\n    class Meta:\n        model = File\n        fields = ['ecole', 'file', 'description']\n\n    def validate_ecole(self, value):\n        \"\"\"\n        V\u00e9rifie que l'\u00e9cole existe dans la base de donn\u00e9es.\n\n        Args:\n            value (Ecole): Instance de l'\u00e9cole.\n\n        Raises:\n            serializers.ValidationError: Si l'\u00e9cole n'existe pas.\n\n        Returns:\n            Ecole: L'\u00e9cole valid\u00e9e.\n        \"\"\"\n        if not Ecole.objects.filter(id=value.id).exists():\n            raise serializers.ValidationError(\"\u00c9cole non trouv\u00e9e\")\n        return value\n</code></pre> <ul> <li>Pour l\u2019upload de fichiers.</li> <li>Validation : existence de l\u2019\u00e9cole.</li> </ul>"},{"location":"api/files/#files.serializers.FileUploadSerializer.validate_ecole","title":"<code>validate_ecole(value)</code>","text":"<p>V\u00e9rifie que l'\u00e9cole existe dans la base de donn\u00e9es.</p> <p>Parameters:</p> <ul> <li> <code>value</code>               (<code>Ecole</code>)           \u2013            <p>Instance de l'\u00e9cole.</p> </li> </ul> <p>Raises:</p> <ul> <li> <code>ValidationError</code>             \u2013            <p>Si l'\u00e9cole n'existe pas.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>Ecole</code>          \u2013            <p>L'\u00e9cole valid\u00e9e.</p> </li> </ul> Source code in <code>files/serializers.py</code> <pre><code>def validate_ecole(self, value):\n    \"\"\"\n    V\u00e9rifie que l'\u00e9cole existe dans la base de donn\u00e9es.\n\n    Args:\n        value (Ecole): Instance de l'\u00e9cole.\n\n    Raises:\n        serializers.ValidationError: Si l'\u00e9cole n'existe pas.\n\n    Returns:\n        Ecole: L'\u00e9cole valid\u00e9e.\n    \"\"\"\n    if not Ecole.objects.filter(id=value.id).exists():\n        raise serializers.ValidationError(\"\u00c9cole non trouv\u00e9e\")\n    return value\n</code></pre>"},{"location":"api/files/#23-serialiseur-pour-listes","title":"2.3 S\u00e9rialiseur pour listes","text":"<p>               Bases: <code>ModelSerializer</code></p> <p>S\u00e9rialiseur l\u00e9ger pour lister les fichiers.</p> <p>Fournit uniquement les informations essentielles pour les listes ou aper\u00e7us : - Nom du fichier - Type - Taille - Nom de l'\u00e9cole - Nom de l'utilisateur ayant upload\u00e9 - Date de cr\u00e9ation</p> Source code in <code>files/serializers.py</code> <pre><code>class FileListSerializer(serializers.ModelSerializer):\n    \"\"\"\n    S\u00e9rialiseur l\u00e9ger pour lister les fichiers.\n\n    Fournit uniquement les informations essentielles pour les listes ou aper\u00e7us :\n    - Nom du fichier\n    - Type\n    - Taille\n    - Nom de l'\u00e9cole\n    - Nom de l'utilisateur ayant upload\u00e9\n    - Date de cr\u00e9ation\n    \"\"\"\n    ecole_name = serializers.CharField(\n        source='ecole.name',\n        read_only=True\n    )\n    uploaded_by_username = serializers.CharField(\n        source='uploaded_by.username',\n        read_only=True\n    )\n\n    class Meta:\n        model = File\n        fields = [\n            'id', 'filename', 'file_type', 'file_size',\n            'ecole', 'ecole_name', 'uploaded_by_username', 'uploaded_at'\n        ]\n</code></pre> <ul> <li>S\u00e9rialiseur l\u00e9ger pour afficher les fichiers dans des listes.</li> <li>Champs : <code>id</code>, <code>filename</code>, <code>file_type</code>, <code>file_size</code>, <code>ecole_name</code>, <code>uploaded_by_username</code>, <code>uploaded_at</code>.</li> </ul>"},{"location":"api/files/#3-vues","title":"3. Vues","text":""},{"location":"api/files/#31-viewset-principal","title":"3.1 ViewSet principal","text":"<p>               Bases: <code>ModelViewSet</code></p> <p>ViewSet pour la gestion des fichiers.</p> <p>Fournit les op\u00e9rations CRUD standard, ainsi que des actions personnalis\u00e9es : - T\u00e9l\u00e9charger un fichier (<code>download</code>) - Upload multiple de fichiers (<code>upload_multiple</code>)</p> <p>Permissions : - Authentification requise pour toutes les actions. - Seuls les admins peuvent supprimer ou mettre \u00e0 jour des fichiers.</p> <p>Parsing : - Supporte MultiPart et Form pour l'upload de fichiers.</p> Source code in <code>files/views.py</code> <pre><code>class FileViewSet(viewsets.ModelViewSet):\n    \"\"\"\n    ViewSet pour la gestion des fichiers.\n\n    Fournit les op\u00e9rations CRUD standard, ainsi que des actions personnalis\u00e9es :\n    - T\u00e9l\u00e9charger un fichier (`download`)\n    - Upload multiple de fichiers (`upload_multiple`)\n\n    Permissions :\n    - Authentification requise pour toutes les actions.\n    - Seuls les admins peuvent supprimer ou mettre \u00e0 jour des fichiers.\n\n    Parsing :\n    - Supporte MultiPart et Form pour l'upload de fichiers.\n    \"\"\"\n    queryset = File.objects.select_related('ecole', 'uploaded_by')\n    permission_classes = [IsAuthenticated]\n    parser_classes = [MultiPartParser, FormParser]\n\n    def get_serializer_class(self):\n        \"\"\"\n        Retourne le s\u00e9rialiseur appropri\u00e9 selon l'action.\n\n        Returns:\n            Serializer: Classe de s\u00e9rialiseur adapt\u00e9e.\n        \"\"\"\n        if self.action == 'list':\n            return FileListSerializer\n        elif self.action == 'create':\n            return FileUploadSerializer\n        return FileSerializer\n\n    def get_permissions(self):\n        \"\"\"\n        D\u00e9termine les permissions selon l'action.\n\n        Returns:\n            list: Liste des classes de permissions.\n        \"\"\"\n        if self.action in ['destroy', 'update', 'partial_update']:\n            return [IsAdminUser()]\n        return [IsAuthenticated()]\n\n    def get_queryset(self):\n        \"\"\"\n        Retourne le queryset filtr\u00e9 selon les param\u00e8tres de requ\u00eate.\n\n        Query params support\u00e9s :\n        - `ecole`: Filtrer par ID d'\u00e9cole\n        - `type`: Filtrer par type de fichier\n        - `my_files`: Si vrai, retourne uniquement les fichiers upload\u00e9s par l'utilisateur connect\u00e9\n\n        Returns:\n            QuerySet: Fichiers filtr\u00e9s.\n        \"\"\"\n        queryset = self.queryset\n\n        ecole_id = self.request.query_params.get('ecole')\n        if ecole_id:\n            queryset = queryset.filter(ecole_id=ecole_id)\n\n        file_type = self.request.query_params.get('type')\n        if file_type:\n            queryset = queryset.filter(file_type=file_type)\n\n        my_files = self.request.query_params.get('my_files')\n        if my_files:\n            queryset = queryset.filter(uploaded_by=self.request.user)\n\n        return queryset\n\n    def perform_create(self, serializer):\n        \"\"\"\n        Associe automatiquement l'utilisateur connect\u00e9 lors de la cr\u00e9ation d'un fichier.\n\n        Args:\n            serializer (Serializer): S\u00e9rialiseur valid\u00e9.\n        \"\"\"\n        serializer.save(uploaded_by=self.request.user)\n\n    @action(detail=True, methods=['get'])\n    def download(self, request, pk=None):\n        \"\"\"\n        T\u00e9l\u00e9charger un fichier donn\u00e9.\n\n        Args:\n            request (Request): Requ\u00eate HTTP\n            pk (int): ID du fichier\n\n        Returns:\n            FileResponse: R\u00e9ponse HTTP avec le fichier en pi\u00e8ce jointe.\n\n        Raises:\n            Http404: Si le fichier n'existe pas sur le serveur.\n        \"\"\"\n        file_obj = self.get_object()\n        try:\n            response = FileResponse(\n                file_obj.file.open('rb'),\n                content_type=file_obj.mime_type\n            )\n            response['Content-Disposition'] = f'attachment; filename=\"{file_obj.filename}\"'\n            return response\n        except FileNotFoundError:\n            raise Http404(\"Fichier non trouv\u00e9 sur le serveur\")\n\n    @action(detail=False, methods=['post'])\n    def upload_multiple(self, request):\n        \"\"\"\n        Upload multiple fichiers vers une \u00e9cole sp\u00e9cifique.\n\n        Requ\u00eate attendue :\n        - `ecole`: ID de l'\u00e9cole\n        - `files`: Liste de fichiers\n        - `description`: Optionnel\n\n        Returns:\n            Response: D\u00e9tails sur les fichiers upload\u00e9s et les erreurs \u00e9ventuelles.\n        \"\"\"\n        ecole_id = request.data.get('ecole')\n        if not ecole_id:\n            return Response({'error': 'ecole_id requis'}, status=status.HTTP_400_BAD_REQUEST)\n\n        school = get_object_or_404(Ecole, pk=ecole_id)\n        files = request.FILES.getlist('files')\n\n        if not files:\n            return Response({'error': 'Aucun fichier fourni'}, status=status.HTTP_400_BAD_REQUEST)\n\n        uploaded_files = []\n        errors = []\n\n        for file in files:\n            serializer = FileUploadSerializer(data={\n                'ecole': school.id,\n                'file': file,\n                'description': request.data.get('description', '')\n            })\n\n            if serializer.is_valid():\n                file_obj = serializer.save(uploaded_by=request.user)\n                uploaded_files.append(FileSerializer(file_obj, context={'request': request}).data)\n            else:\n                errors.append({'filename': file.name, 'errors': serializer.errors})\n\n        return Response(\n            {\n                'uploaded': len(uploaded_files),\n                'failed': len(errors),\n                'files': uploaded_files,\n                'errors': errors\n            },\n            status=status.HTTP_201_CREATED if uploaded_files else status.HTTP_400_BAD_REQUEST\n        )\n</code></pre> <ul> <li>Gestion compl\u00e8te CRUD via DRF.</li> <li>Actions personnalis\u00e9es : <code>download</code>, <code>upload_multiple</code>.</li> <li>Filtrage : par \u00e9cole, type de fichier, fichiers de l'utilisateur.</li> <li>Permissions :<ul> <li>Admin uniquement pour suppression et mise \u00e0 jour.</li> <li>Authentification requise pour lecture et upload.</li> </ul> </li> </ul>"},{"location":"api/files/#files.views.FileViewSet.download","title":"<code>download(request, pk=None)</code>","text":"<p>T\u00e9l\u00e9charger un fichier donn\u00e9.</p> <p>Parameters:</p> <ul> <li> <code>request</code>               (<code>Request</code>)           \u2013            <p>Requ\u00eate HTTP</p> </li> <li> <code>pk</code>               (<code>int</code>, default:                   <code>None</code> )           \u2013            <p>ID du fichier</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>FileResponse</code>          \u2013            <p>R\u00e9ponse HTTP avec le fichier en pi\u00e8ce jointe.</p> </li> </ul> <p>Raises:</p> <ul> <li> <code>Http404</code>             \u2013            <p>Si le fichier n'existe pas sur le serveur.</p> </li> </ul> Source code in <code>files/views.py</code> <pre><code>@action(detail=True, methods=['get'])\ndef download(self, request, pk=None):\n    \"\"\"\n    T\u00e9l\u00e9charger un fichier donn\u00e9.\n\n    Args:\n        request (Request): Requ\u00eate HTTP\n        pk (int): ID du fichier\n\n    Returns:\n        FileResponse: R\u00e9ponse HTTP avec le fichier en pi\u00e8ce jointe.\n\n    Raises:\n        Http404: Si le fichier n'existe pas sur le serveur.\n    \"\"\"\n    file_obj = self.get_object()\n    try:\n        response = FileResponse(\n            file_obj.file.open('rb'),\n            content_type=file_obj.mime_type\n        )\n        response['Content-Disposition'] = f'attachment; filename=\"{file_obj.filename}\"'\n        return response\n    except FileNotFoundError:\n        raise Http404(\"Fichier non trouv\u00e9 sur le serveur\")\n</code></pre>"},{"location":"api/files/#files.views.FileViewSet.get_permissions","title":"<code>get_permissions()</code>","text":"<p>D\u00e9termine les permissions selon l'action.</p> <p>Returns:</p> <ul> <li> <code>list</code>          \u2013            <p>Liste des classes de permissions.</p> </li> </ul> Source code in <code>files/views.py</code> <pre><code>def get_permissions(self):\n    \"\"\"\n    D\u00e9termine les permissions selon l'action.\n\n    Returns:\n        list: Liste des classes de permissions.\n    \"\"\"\n    if self.action in ['destroy', 'update', 'partial_update']:\n        return [IsAdminUser()]\n    return [IsAuthenticated()]\n</code></pre>"},{"location":"api/files/#files.views.FileViewSet.get_queryset","title":"<code>get_queryset()</code>","text":"<p>Retourne le queryset filtr\u00e9 selon les param\u00e8tres de requ\u00eate.</p> <p>Query params support\u00e9s : - <code>ecole</code>: Filtrer par ID d'\u00e9cole - <code>type</code>: Filtrer par type de fichier - <code>my_files</code>: Si vrai, retourne uniquement les fichiers upload\u00e9s par l'utilisateur connect\u00e9</p> <p>Returns:</p> <ul> <li> <code>QuerySet</code>          \u2013            <p>Fichiers filtr\u00e9s.</p> </li> </ul> Source code in <code>files/views.py</code> <pre><code>def get_queryset(self):\n    \"\"\"\n    Retourne le queryset filtr\u00e9 selon les param\u00e8tres de requ\u00eate.\n\n    Query params support\u00e9s :\n    - `ecole`: Filtrer par ID d'\u00e9cole\n    - `type`: Filtrer par type de fichier\n    - `my_files`: Si vrai, retourne uniquement les fichiers upload\u00e9s par l'utilisateur connect\u00e9\n\n    Returns:\n        QuerySet: Fichiers filtr\u00e9s.\n    \"\"\"\n    queryset = self.queryset\n\n    ecole_id = self.request.query_params.get('ecole')\n    if ecole_id:\n        queryset = queryset.filter(ecole_id=ecole_id)\n\n    file_type = self.request.query_params.get('type')\n    if file_type:\n        queryset = queryset.filter(file_type=file_type)\n\n    my_files = self.request.query_params.get('my_files')\n    if my_files:\n        queryset = queryset.filter(uploaded_by=self.request.user)\n\n    return queryset\n</code></pre>"},{"location":"api/files/#files.views.FileViewSet.get_serializer_class","title":"<code>get_serializer_class()</code>","text":"<p>Retourne le s\u00e9rialiseur appropri\u00e9 selon l'action.</p> <p>Returns:</p> <ul> <li> <code>Serializer</code>          \u2013            <p>Classe de s\u00e9rialiseur adapt\u00e9e.</p> </li> </ul> Source code in <code>files/views.py</code> <pre><code>def get_serializer_class(self):\n    \"\"\"\n    Retourne le s\u00e9rialiseur appropri\u00e9 selon l'action.\n\n    Returns:\n        Serializer: Classe de s\u00e9rialiseur adapt\u00e9e.\n    \"\"\"\n    if self.action == 'list':\n        return FileListSerializer\n    elif self.action == 'create':\n        return FileUploadSerializer\n    return FileSerializer\n</code></pre>"},{"location":"api/files/#files.views.FileViewSet.perform_create","title":"<code>perform_create(serializer)</code>","text":"<p>Associe automatiquement l'utilisateur connect\u00e9 lors de la cr\u00e9ation d'un fichier.</p> <p>Parameters:</p> <ul> <li> <code>serializer</code>               (<code>Serializer</code>)           \u2013            <p>S\u00e9rialiseur valid\u00e9.</p> </li> </ul> Source code in <code>files/views.py</code> <pre><code>def perform_create(self, serializer):\n    \"\"\"\n    Associe automatiquement l'utilisateur connect\u00e9 lors de la cr\u00e9ation d'un fichier.\n\n    Args:\n        serializer (Serializer): S\u00e9rialiseur valid\u00e9.\n    \"\"\"\n    serializer.save(uploaded_by=self.request.user)\n</code></pre>"},{"location":"api/files/#files.views.FileViewSet.upload_multiple","title":"<code>upload_multiple(request)</code>","text":"<p>Upload multiple fichiers vers une \u00e9cole sp\u00e9cifique.</p> <p>Requ\u00eate attendue : - <code>ecole</code>: ID de l'\u00e9cole - <code>files</code>: Liste de fichiers - <code>description</code>: Optionnel</p> <p>Returns:</p> <ul> <li> <code>Response</code>          \u2013            <p>D\u00e9tails sur les fichiers upload\u00e9s et les erreurs \u00e9ventuelles.</p> </li> </ul> Source code in <code>files/views.py</code> <pre><code>@action(detail=False, methods=['post'])\ndef upload_multiple(self, request):\n    \"\"\"\n    Upload multiple fichiers vers une \u00e9cole sp\u00e9cifique.\n\n    Requ\u00eate attendue :\n    - `ecole`: ID de l'\u00e9cole\n    - `files`: Liste de fichiers\n    - `description`: Optionnel\n\n    Returns:\n        Response: D\u00e9tails sur les fichiers upload\u00e9s et les erreurs \u00e9ventuelles.\n    \"\"\"\n    ecole_id = request.data.get('ecole')\n    if not ecole_id:\n        return Response({'error': 'ecole_id requis'}, status=status.HTTP_400_BAD_REQUEST)\n\n    school = get_object_or_404(Ecole, pk=ecole_id)\n    files = request.FILES.getlist('files')\n\n    if not files:\n        return Response({'error': 'Aucun fichier fourni'}, status=status.HTTP_400_BAD_REQUEST)\n\n    uploaded_files = []\n    errors = []\n\n    for file in files:\n        serializer = FileUploadSerializer(data={\n            'ecole': school.id,\n            'file': file,\n            'description': request.data.get('description', '')\n        })\n\n        if serializer.is_valid():\n            file_obj = serializer.save(uploaded_by=request.user)\n            uploaded_files.append(FileSerializer(file_obj, context={'request': request}).data)\n        else:\n            errors.append({'filename': file.name, 'errors': serializer.errors})\n\n    return Response(\n        {\n            'uploaded': len(uploaded_files),\n            'failed': len(errors),\n            'files': uploaded_files,\n            'errors': errors\n        },\n        status=status.HTTP_201_CREATED if uploaded_files else status.HTTP_400_BAD_REQUEST\n    )\n</code></pre>"},{"location":"api/files/#4-utils","title":"4. Utils","text":"<ul> <li>Fonctions utilitaires :<ul> <li><code>get_file_path()</code> : chemin de stockage</li> <li><code>determine_file_type()</code> : type bas\u00e9 sur l'extension</li> <li><code>get_mime_type()</code> : d\u00e9tection du type MIME</li> </ul> </li> </ul>"},{"location":"api/files/#files.utils.determine_file_type","title":"<code>determine_file_type(filename)</code>","text":"<p>D\u00e9termine le type de fichier \u00e0 partir de son extension.</p> Les types support\u00e9s <ul> <li>PDF</li> <li>Image (jpg, jpeg, png, gif)</li> <li>Document (doc, docx)</li> <li>Tableur (xls, xlsx, csv)</li> <li>Texte (txt)</li> <li>Autre pour les extensions non reconnues</li> </ul> <p>Parameters:</p> <ul> <li> <code>filename</code>               (<code>str</code>)           \u2013            <p>Nom du fichier.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>str</code>          \u2013            <p>Type de fichier ('pdf', 'image', 'document', 'spreadsheet', 'text', 'other').</p> </li> </ul> Source code in <code>files/utils.py</code> <pre><code>def determine_file_type(filename):\n    \"\"\"\n    D\u00e9termine le type de fichier \u00e0 partir de son extension.\n\n    Les types support\u00e9s :\n        - PDF\n        - Image (jpg, jpeg, png, gif)\n        - Document (doc, docx)\n        - Tableur (xls, xlsx, csv)\n        - Texte (txt)\n        - Autre pour les extensions non reconnues\n\n    Args:\n        filename (str): Nom du fichier.\n\n    Returns:\n        str: Type de fichier ('pdf', 'image', 'document', 'spreadsheet', 'text', 'other').\n    \"\"\"\n    ext = os.path.splitext(filename)[1].lower()\n\n    type_mapping = {\n        '.pdf': 'pdf',\n        '.jpg': 'image', '.jpeg': 'image', '.png': 'image', '.gif': 'image',\n        '.doc': 'document', '.docx': 'document',\n        '.xls': 'spreadsheet', '.xlsx': 'spreadsheet', '.csv': 'spreadsheet',\n        '.txt': 'text',\n    }\n\n    return type_mapping.get(ext, 'other')\n</code></pre>"},{"location":"api/files/#files.utils.get_file_path","title":"<code>get_file_path(instance, filename)</code>","text":"<p>G\u00e9n\u00e8re le chemin de stockage pour un fichier upload\u00e9.</p> Le fichier sera stock\u00e9 sous <p>schools/{id_ecole}/files/{nom_fichier}</p> <p>Parameters:</p> <ul> <li> <code>instance</code>               (<code>File</code>)           \u2013            <p>Instance du mod\u00e8le File.</p> </li> <li> <code>filename</code>               (<code>str</code>)           \u2013            <p>Nom original du fichier.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>str</code>          \u2013            <p>Chemin relatif o\u00f9 le fichier sera stock\u00e9.</p> </li> </ul> Source code in <code>files/utils.py</code> <pre><code>def get_file_path(instance, filename):\n    \"\"\"\n    G\u00e9n\u00e8re le chemin de stockage pour un fichier upload\u00e9.\n\n    Le fichier sera stock\u00e9 sous :\n        schools/{id_ecole}/files/{nom_fichier}\n\n    Args:\n        instance (File): Instance du mod\u00e8le File.\n        filename (str): Nom original du fichier.\n\n    Returns:\n        str: Chemin relatif o\u00f9 le fichier sera stock\u00e9.\n    \"\"\"\n    return f'schools/{instance.ecole.id}/files/{filename}'\n</code></pre>"},{"location":"api/files/#files.utils.get_mime_type","title":"<code>get_mime_type(filename)</code>","text":"<p>R\u00e9cup\u00e8re le type MIME d'un fichier.</p> <p>Utilise la librairie standard <code>mimetypes</code> pour deviner le MIME. Si le type ne peut pas \u00eatre d\u00e9termin\u00e9, retourne 'application/octet-stream'.</p> <p>Parameters:</p> <ul> <li> <code>filename</code>               (<code>str</code>)           \u2013            <p>Nom du fichier.</p> </li> </ul> <p>Returns:</p> <ul> <li> <code>str</code>          \u2013            <p>Type MIME du fichier.</p> </li> </ul> Source code in <code>files/utils.py</code> <pre><code>def get_mime_type(filename):\n    \"\"\"\n    R\u00e9cup\u00e8re le type MIME d'un fichier.\n\n    Utilise la librairie standard `mimetypes` pour deviner le MIME.\n    Si le type ne peut pas \u00eatre d\u00e9termin\u00e9, retourne 'application/octet-stream'.\n\n    Args:\n        filename (str): Nom du fichier.\n\n    Returns:\n        str: Type MIME du fichier.\n    \"\"\"\n    mime_type, _ = mimetypes.guess_type(filename)\n    return mime_type or 'application/octet-stream'\n</code></pre>"},{"location":"api/files/#5-validators","title":"5. Validators","text":"<ul> <li>Validation des fichiers :<ul> <li><code>validate_file_size()</code> : limite 10MB</li> <li><code>validate_file_extension()</code> : extensions autoris\u00e9es</li> </ul> </li> </ul>"},{"location":"api/files/#files.validators.validate_file_extension","title":"<code>validate_file_extension(file)</code>","text":"<p>Valide que le fichier a une extension autoris\u00e9e.</p> Extensions autoris\u00e9es <ul> <li>PDF (.pdf)</li> <li>Images (.jpg, .jpeg, .png, .gif)</li> <li>Documents Word (.doc, .docx)</li> <li>Tableurs (.xls, .xlsx, .csv)</li> <li>Texte (.txt)</li> </ul> <p>Parameters:</p> <ul> <li> <code>file</code>               (<code>File</code>)           \u2013            <p>Fichier \u00e0 valider.</p> </li> </ul> <p>Raises:</p> <ul> <li> <code>ValidationError</code>             \u2013            <p>Si l'extension du fichier n'est pas autoris\u00e9e.</p> </li> </ul> Exemple <p>validate_file_extension(myfile)</p> Source code in <code>files/validators.py</code> <pre><code>def validate_file_extension(file):\n    \"\"\"\n    Valide que le fichier a une extension autoris\u00e9e.\n\n    Extensions autoris\u00e9es :\n        - PDF (.pdf)\n        - Images (.jpg, .jpeg, .png, .gif)\n        - Documents Word (.doc, .docx)\n        - Tableurs (.xls, .xlsx, .csv)\n        - Texte (.txt)\n\n    Args:\n        file (File): Fichier \u00e0 valider.\n\n    Raises:\n        ValidationError: Si l'extension du fichier n'est pas autoris\u00e9e.\n\n    Exemple:\n        &gt;&gt;&gt; validate_file_extension(myfile)\n    \"\"\"\n    allowed_extensions = [\n        '.pdf', '.jpg', '.jpeg', '.png', '.doc', '.docx',\n        '.xls', '.xlsx', '.txt', '.csv', '.gif'\n    ]\n    ext = os.path.splitext(file.name)[1].lower()\n    if ext not in allowed_extensions:\n        raise ValidationError(\n            f'Extension de fichier non autoris\u00e9e. Extensions autoris\u00e9es: {\", \".join(allowed_extensions)}'\n        )\n</code></pre>"},{"location":"api/files/#files.validators.validate_file_size","title":"<code>validate_file_size(file)</code>","text":"<p>Valide que la taille d'un fichier ne d\u00e9passe pas 10MB.</p> <p>Parameters:</p> <ul> <li> <code>file</code>               (<code>File</code>)           \u2013            <p>Fichier \u00e0 valider.</p> </li> </ul> <p>Raises:</p> <ul> <li> <code>ValidationError</code>             \u2013            <p>Si la taille du fichier d\u00e9passe 10MB.</p> </li> </ul> Exemple <p>validate_file_size(myfile)</p> Source code in <code>files/validators.py</code> <pre><code>def validate_file_size(file):\n    \"\"\"\n    Valide que la taille d'un fichier ne d\u00e9passe pas 10MB.\n\n    Args:\n        file (File): Fichier \u00e0 valider.\n\n    Raises:\n        ValidationError: Si la taille du fichier d\u00e9passe 10MB.\n\n    Exemple:\n        &gt;&gt;&gt; validate_file_size(myfile)\n    \"\"\"\n    max_size_mb = 10\n    if file.size &gt; max_size_mb * 1024 * 1024:\n        raise ValidationError(f'La taille du fichier ne doit pas d\u00e9passer {max_size_mb}MB')\n</code></pre>"},{"location":"api/files/#6-urls","title":"6. URLs","text":""},{"location":"api/files/#files.urls.urlpatterns","title":"<code>urlpatterns = [path('', include(router.urls))]</code>  <code>module-attribute</code>","text":"<p>URL patterns pour l'app \"files\".</p> <ul> <li>Toutes les routes du ViewSet FileViewSet sont incluses via le router DRF.</li> <li><code>app_name</code> permet de nommer les routes pour l'utilisation dans les templates et reverse().</li> </ul>"},{"location":"api/files/#61-routes-api-disponibles","title":"6.1 Routes API disponibles","text":"M\u00e9thode Endpoint Action GET /api/files/ Liste fichiers (filtrable) POST /api/files/ Upload fichier unique POST /api/files/upload_multiple/ Upload multiple fichiers GET /api/files/{id}/ D\u00e9tails d'un fichier PUT /api/files/{id}/ Mise \u00e0 jour (admin) PATCH /api/files/{id}/ Mise \u00e0 jour partielle (admin) DELETE /api/files/{id}/ Suppression (admin) GET /api/files/{id}/download/ T\u00e9l\u00e9chargement fichier"},{"location":"api/files/#7-tests","title":"7. Tests","text":""},{"location":"api/files/#71-description-generale","title":"7.1 Description g\u00e9n\u00e9rale","text":"<ul> <li>Contient des tests unitaires et d'int\u00e9gration pour valider le fonctionnement du module File.</li> <li>Tests sur : mod\u00e8les, API (CRUD), filtrages, upload simple et multiple, suppression, t\u00e9l\u00e9chargement, pagination.</li> </ul>"},{"location":"api/files/#files.tests.FileAPITest","title":"<code>FileAPITest</code>","text":"<p>               Bases: <code>APITestCase</code></p> <p>Tests fonctionnels de l'API Files</p> Source code in <code>files/tests.py</code> <pre><code>class FileAPITest(APITestCase):\n    \"\"\"Tests fonctionnels de l'API Files\"\"\"\n\n    def setUp(self):\n        \"\"\"Cr\u00e9ation d'utilisateur et d'\u00e9coles pour les tests API\"\"\"\n        self.user = User.objects.create_user(username='apiuser', password='api123')\n        self.client.force_authenticate(user=self.user)\n        self.ecole = Ecole.objects.create(\n            name='\u00c9cole API',\n            address='456 Rue API',\n            city='Lyon',\n            postal_code='69001',\n            phone='0987654321',\n            students_count=20\n        )\n        self.ecole2 = Ecole.objects.create(\n            name='\u00c9cole API 2',\n            address='789 Rue Test',\n            city='Paris',\n            postal_code='75001',\n            phone='0123456789',\n            students_count=30\n        )\n\n    def test_upload_file(self):\n        \"\"\"Test: Upload d'un fichier via l'API.\n\n        V\u00e9rifie que l'utilisateur authentifi\u00e9 peut uploader un fichier\n        et que l'objet File est cr\u00e9\u00e9 correctement.\n\n        Asserts:\n            - Status code 201 Created\n            - File count == 1\n            - uploaded_by == utilisateur courant\n        \"\"\"\n        file = SimpleUploadedFile(\"upload.pdf\", b\"content\", content_type=\"application/pdf\")\n        response = self.client.post(\n            '/api/files/',\n            {'ecole': self.ecole.id, 'file': file, 'description': 'Test'},\n            format='multipart'\n        )\n        self.assertEqual(response.status_code, status.HTTP_201_CREATED)\n        self.assertEqual(File.objects.count(), 1)\n        self.assertEqual(File.objects.first().uploaded_by, self.user)\n\n    def test_delete_file_admin_only(self):\n        \"\"\"Test: Tentative de suppression par un utilisateur standard.\n\n        V\u00e9rifie qu'un utilisateur sans r\u00f4le admin ne peut pas supprimer\n        un fichier et que celui-ci reste en base.\n\n        Asserts:\n            - Status code: 403 Forbidden\n            - Le fichier existe toujours en base de donn\u00e9es\n        \"\"\"\n        file_obj = File.objects.create(\n            ecole=self.ecole,\n            uploaded_by=self.user,\n            file=SimpleUploadedFile(\"delete.txt\", b\"content\"),\n            filename=\"delete.txt\",\n            file_size=100\n        )\n        response = self.client.delete(f'/api/files/{file_obj.id}/')\n        self.assertEqual(response.status_code, status.HTTP_403_FORBIDDEN)\n        self.assertEqual(File.objects.count(), 1)\n\n    def test_delete_file_admin_success(self):\n        \"\"\"Test: Suppression par un utilisateur admin.\n\n        V\u00e9rifie qu'un superuser peut supprimer un fichier.\n\n        Asserts:\n            - Status code 204 No Content\n            - Le fichier est supprim\u00e9 de la base\n        \"\"\"\n        admin_user = User.objects.create_superuser(username='adminuser', password='admin123')\n        file_obj = File.objects.create(\n            ecole=self.ecole,\n            uploaded_by=self.user,\n            file=SimpleUploadedFile(\"delete_admin.txt\", b\"content\"),\n            filename=\"delete_admin.txt\",\n            file_size=100\n        )\n        self.client.force_authenticate(user=admin_user)\n        response = self.client.delete(f'/api/files/{file_obj.id}/')\n        self.assertEqual(response.status_code, status.HTTP_204_NO_CONTENT)\n        self.assertEqual(File.objects.count(), 0)\n</code></pre>"},{"location":"api/files/#files.tests.FileAPITest.setUp","title":"<code>setUp()</code>","text":"<p>Cr\u00e9ation d'utilisateur et d'\u00e9coles pour les tests API</p> Source code in <code>files/tests.py</code> <pre><code>def setUp(self):\n    \"\"\"Cr\u00e9ation d'utilisateur et d'\u00e9coles pour les tests API\"\"\"\n    self.user = User.objects.create_user(username='apiuser', password='api123')\n    self.client.force_authenticate(user=self.user)\n    self.ecole = Ecole.objects.create(\n        name='\u00c9cole API',\n        address='456 Rue API',\n        city='Lyon',\n        postal_code='69001',\n        phone='0987654321',\n        students_count=20\n    )\n    self.ecole2 = Ecole.objects.create(\n        name='\u00c9cole API 2',\n        address='789 Rue Test',\n        city='Paris',\n        postal_code='75001',\n        phone='0123456789',\n        students_count=30\n    )\n</code></pre>"},{"location":"api/files/#files.tests.FileAPITest.test_delete_file_admin_only","title":"<code>test_delete_file_admin_only()</code>","text":"<p>Test: Tentative de suppression par un utilisateur standard.</p> <p>V\u00e9rifie qu'un utilisateur sans r\u00f4le admin ne peut pas supprimer un fichier et que celui-ci reste en base.</p> Asserts <ul> <li>Status code: 403 Forbidden</li> <li>Le fichier existe toujours en base de donn\u00e9es</li> </ul> Source code in <code>files/tests.py</code> <pre><code>def test_delete_file_admin_only(self):\n    \"\"\"Test: Tentative de suppression par un utilisateur standard.\n\n    V\u00e9rifie qu'un utilisateur sans r\u00f4le admin ne peut pas supprimer\n    un fichier et que celui-ci reste en base.\n\n    Asserts:\n        - Status code: 403 Forbidden\n        - Le fichier existe toujours en base de donn\u00e9es\n    \"\"\"\n    file_obj = File.objects.create(\n        ecole=self.ecole,\n        uploaded_by=self.user,\n        file=SimpleUploadedFile(\"delete.txt\", b\"content\"),\n        filename=\"delete.txt\",\n        file_size=100\n    )\n    response = self.client.delete(f'/api/files/{file_obj.id}/')\n    self.assertEqual(response.status_code, status.HTTP_403_FORBIDDEN)\n    self.assertEqual(File.objects.count(), 1)\n</code></pre>"},{"location":"api/files/#files.tests.FileAPITest.test_delete_file_admin_success","title":"<code>test_delete_file_admin_success()</code>","text":"<p>Test: Suppression par un utilisateur admin.</p> <p>V\u00e9rifie qu'un superuser peut supprimer un fichier.</p> Asserts <ul> <li>Status code 204 No Content</li> <li>Le fichier est supprim\u00e9 de la base</li> </ul> Source code in <code>files/tests.py</code> <pre><code>def test_delete_file_admin_success(self):\n    \"\"\"Test: Suppression par un utilisateur admin.\n\n    V\u00e9rifie qu'un superuser peut supprimer un fichier.\n\n    Asserts:\n        - Status code 204 No Content\n        - Le fichier est supprim\u00e9 de la base\n    \"\"\"\n    admin_user = User.objects.create_superuser(username='adminuser', password='admin123')\n    file_obj = File.objects.create(\n        ecole=self.ecole,\n        uploaded_by=self.user,\n        file=SimpleUploadedFile(\"delete_admin.txt\", b\"content\"),\n        filename=\"delete_admin.txt\",\n        file_size=100\n    )\n    self.client.force_authenticate(user=admin_user)\n    response = self.client.delete(f'/api/files/{file_obj.id}/')\n    self.assertEqual(response.status_code, status.HTTP_204_NO_CONTENT)\n    self.assertEqual(File.objects.count(), 0)\n</code></pre>"},{"location":"api/files/#files.tests.FileAPITest.test_upload_file","title":"<code>test_upload_file()</code>","text":"<p>Test: Upload d'un fichier via l'API.</p> <p>V\u00e9rifie que l'utilisateur authentifi\u00e9 peut uploader un fichier et que l'objet File est cr\u00e9\u00e9 correctement.</p> Asserts <ul> <li>Status code 201 Created</li> <li>File count == 1</li> <li>uploaded_by == utilisateur courant</li> </ul> Source code in <code>files/tests.py</code> <pre><code>def test_upload_file(self):\n    \"\"\"Test: Upload d'un fichier via l'API.\n\n    V\u00e9rifie que l'utilisateur authentifi\u00e9 peut uploader un fichier\n    et que l'objet File est cr\u00e9\u00e9 correctement.\n\n    Asserts:\n        - Status code 201 Created\n        - File count == 1\n        - uploaded_by == utilisateur courant\n    \"\"\"\n    file = SimpleUploadedFile(\"upload.pdf\", b\"content\", content_type=\"application/pdf\")\n    response = self.client.post(\n        '/api/files/',\n        {'ecole': self.ecole.id, 'file': file, 'description': 'Test'},\n        format='multipart'\n    )\n    self.assertEqual(response.status_code, status.HTTP_201_CREATED)\n    self.assertEqual(File.objects.count(), 1)\n    self.assertEqual(File.objects.first().uploaded_by, self.user)\n</code></pre>"},{"location":"api/files/#files.tests.FileModelTest","title":"<code>FileModelTest</code>","text":"<p>               Bases: <code>TestCase</code></p> <p>Tests unitaires pour le mod\u00e8le File</p> Source code in <code>files/tests.py</code> <pre><code>class FileModelTest(TestCase):\n    \"\"\"Tests unitaires pour le mod\u00e8le File\"\"\"\n\n    def setUp(self):\n        \"\"\"Cr\u00e9er un utilisateur et une \u00e9cole pour les tests\"\"\"\n        self.user = User.objects.create_user(\n            username='admin',\n            password='adminpass',\n            role='admin',\n            is_staff=True\n        )\n        self.ecole = Ecole.objects.create(\n            name=\"\u00c9cole Alpha\",\n            address=\"Rue de la R\u00e9publique\",\n            city=\"Sousse\",\n            postal_code=\"4000\",\n            phone=\"12345678\",\n            students_count=200\n        )\n\n    def test_file_creation_with_metadata(self):\n        \"\"\"Test: Cr\u00e9ation d'un fichier avec extraction automatique des m\u00e9tadonn\u00e9es.\n\n        V\u00e9rifie que les champs filename, file_type, file_size et mime_type\n        sont correctement renseign\u00e9s apr\u00e8s la cr\u00e9ation.\n\n        Asserts:\n            - filename correct\n            - file_type correct\n            - file_size &gt; 0\n            - mime_type contient l'extension\n        \"\"\"\n        uploaded_file = SimpleUploadedFile(\"test.pdf\", b\"file_content\", content_type=\"application/pdf\")\n        file_obj = File.objects.create(\n            ecole=self.ecole,\n            uploaded_by=self.user,\n            file=uploaded_file\n        )\n        self.assertEqual(file_obj.filename, 'test.pdf')\n        self.assertEqual(file_obj.file_type, 'pdf')\n        self.assertGreater(file_obj.file_size, 0)\n        self.assertIn('pdf', file_obj.mime_type)\n\n    def test_file_deletion_removes_physical_file(self):\n        \"\"\"Test: Suppression d'un fichier supprime le fichier physique.\n\n        V\u00e9rifie que la suppression de l'objet File supprime \u00e9galement\n        le fichier sur le disque.\n\n        Asserts:\n            - Le fichier existe avant suppression\n            - Le fichier n'existe plus apr\u00e8s suppression\n        \"\"\"\n        uploaded_file = SimpleUploadedFile(\"delete_test.pdf\", b\"content to delete\", content_type=\"application/pdf\")\n        file_obj = File.objects.create(\n            ecole=self.ecole,\n            uploaded_by=self.user,\n            file=uploaded_file\n        )\n\n        file_path = file_obj.file.path\n        self.assertTrue(os.path.exists(file_path))\n\n        file_obj.delete()\n        self.assertFalse(os.path.exists(file_path))\n\n    def test_file_size_display(self):\n        \"\"\"Test: Formatage lisible de la taille d'un fichier.\n\n        V\u00e9rifie que la m\u00e9thode get_file_size_display retourne une\n        cha\u00eene contenant l'unit\u00e9 (B, KB ou MB).\n\n        Asserts:\n            - \"KB\" est pr\u00e9sent pour un fichier de 2KB\n        \"\"\"\n        uploaded_file = SimpleUploadedFile(\"size_test.pdf\", b\"x\" * 2048, content_type=\"application/pdf\")\n        file_obj = File.objects.create(\n            ecole=self.ecole,\n            uploaded_by=self.user,\n            file=uploaded_file\n        )\n        size_display = file_obj.get_file_size_display()\n        self.assertIn('KB', size_display)\n</code></pre>"},{"location":"api/files/#files.tests.FileModelTest.setUp","title":"<code>setUp()</code>","text":"<p>Cr\u00e9er un utilisateur et une \u00e9cole pour les tests</p> Source code in <code>files/tests.py</code> <pre><code>def setUp(self):\n    \"\"\"Cr\u00e9er un utilisateur et une \u00e9cole pour les tests\"\"\"\n    self.user = User.objects.create_user(\n        username='admin',\n        password='adminpass',\n        role='admin',\n        is_staff=True\n    )\n    self.ecole = Ecole.objects.create(\n        name=\"\u00c9cole Alpha\",\n        address=\"Rue de la R\u00e9publique\",\n        city=\"Sousse\",\n        postal_code=\"4000\",\n        phone=\"12345678\",\n        students_count=200\n    )\n</code></pre>"},{"location":"api/files/#files.tests.FileModelTest.test_file_creation_with_metadata","title":"<code>test_file_creation_with_metadata()</code>","text":"<p>Test: Cr\u00e9ation d'un fichier avec extraction automatique des m\u00e9tadonn\u00e9es.</p> <p>V\u00e9rifie que les champs filename, file_type, file_size et mime_type sont correctement renseign\u00e9s apr\u00e8s la cr\u00e9ation.</p> Asserts <ul> <li>filename correct</li> <li>file_type correct</li> <li>file_size &gt; 0</li> <li>mime_type contient l'extension</li> </ul> Source code in <code>files/tests.py</code> <pre><code>def test_file_creation_with_metadata(self):\n    \"\"\"Test: Cr\u00e9ation d'un fichier avec extraction automatique des m\u00e9tadonn\u00e9es.\n\n    V\u00e9rifie que les champs filename, file_type, file_size et mime_type\n    sont correctement renseign\u00e9s apr\u00e8s la cr\u00e9ation.\n\n    Asserts:\n        - filename correct\n        - file_type correct\n        - file_size &gt; 0\n        - mime_type contient l'extension\n    \"\"\"\n    uploaded_file = SimpleUploadedFile(\"test.pdf\", b\"file_content\", content_type=\"application/pdf\")\n    file_obj = File.objects.create(\n        ecole=self.ecole,\n        uploaded_by=self.user,\n        file=uploaded_file\n    )\n    self.assertEqual(file_obj.filename, 'test.pdf')\n    self.assertEqual(file_obj.file_type, 'pdf')\n    self.assertGreater(file_obj.file_size, 0)\n    self.assertIn('pdf', file_obj.mime_type)\n</code></pre>"},{"location":"api/files/#files.tests.FileModelTest.test_file_deletion_removes_physical_file","title":"<code>test_file_deletion_removes_physical_file()</code>","text":"<p>Test: Suppression d'un fichier supprime le fichier physique.</p> <p>V\u00e9rifie que la suppression de l'objet File supprime \u00e9galement le fichier sur le disque.</p> Asserts <ul> <li>Le fichier existe avant suppression</li> <li>Le fichier n'existe plus apr\u00e8s suppression</li> </ul> Source code in <code>files/tests.py</code> <pre><code>def test_file_deletion_removes_physical_file(self):\n    \"\"\"Test: Suppression d'un fichier supprime le fichier physique.\n\n    V\u00e9rifie que la suppression de l'objet File supprime \u00e9galement\n    le fichier sur le disque.\n\n    Asserts:\n        - Le fichier existe avant suppression\n        - Le fichier n'existe plus apr\u00e8s suppression\n    \"\"\"\n    uploaded_file = SimpleUploadedFile(\"delete_test.pdf\", b\"content to delete\", content_type=\"application/pdf\")\n    file_obj = File.objects.create(\n        ecole=self.ecole,\n        uploaded_by=self.user,\n        file=uploaded_file\n    )\n\n    file_path = file_obj.file.path\n    self.assertTrue(os.path.exists(file_path))\n\n    file_obj.delete()\n    self.assertFalse(os.path.exists(file_path))\n</code></pre>"},{"location":"api/files/#files.tests.FileModelTest.test_file_size_display","title":"<code>test_file_size_display()</code>","text":"<p>Test: Formatage lisible de la taille d'un fichier.</p> <p>V\u00e9rifie que la m\u00e9thode get_file_size_display retourne une cha\u00eene contenant l'unit\u00e9 (B, KB ou MB).</p> Asserts <ul> <li>\"KB\" est pr\u00e9sent pour un fichier de 2KB</li> </ul> Source code in <code>files/tests.py</code> <pre><code>def test_file_size_display(self):\n    \"\"\"Test: Formatage lisible de la taille d'un fichier.\n\n    V\u00e9rifie que la m\u00e9thode get_file_size_display retourne une\n    cha\u00eene contenant l'unit\u00e9 (B, KB ou MB).\n\n    Asserts:\n        - \"KB\" est pr\u00e9sent pour un fichier de 2KB\n    \"\"\"\n    uploaded_file = SimpleUploadedFile(\"size_test.pdf\", b\"x\" * 2048, content_type=\"application/pdf\")\n    file_obj = File.objects.create(\n        ecole=self.ecole,\n        uploaded_by=self.user,\n        file=uploaded_file\n    )\n    size_display = file_obj.get_file_size_display()\n    self.assertIn('KB', size_display)\n</code></pre>"},{"location":"api/files/#72-tableau-recapitulatif-des-tests","title":"7.2 Tableau r\u00e9capitulatif des tests","text":"Cat\u00e9gorie Test Description / Comportement attendu Asserts principaux Mod\u00e8le Cr\u00e9ation fichier V\u00e9rifie <code>filename</code>, <code>file_type</code>, <code>file_size</code> et <code>mime_type</code> <code>filename</code>, <code>file_type</code>, <code>file_size &gt; 0</code>, <code>mime_type</code> correct Suppression physique Supprime l'objet File et le fichier sur le disque Fichier existait avant, fichier supprim\u00e9 apr\u00e8s Formatage taille V\u00e9rifie <code>get_file_size_display()</code> retourne une cha\u00eene lisible (B, KB, MB) Contient unit\u00e9 <code>KB</code> pour 2KB API - Upload Upload fichier unique Authentifi\u00e9 peut uploader un fichier Status 201, objet File cr\u00e9\u00e9, <code>uploaded_by</code> correct Upload multiple fichiers Upload simultan\u00e9 de plusieurs fichiers Tous fichiers cr\u00e9\u00e9s, erreurs collect\u00e9es Upload sans authentification Non authentifi\u00e9 ne peut pas uploader Status 401/403, aucun fichier cr\u00e9\u00e9 API - Lecture / List Liste fichiers R\u00e9cup\u00e9ration de la liste compl\u00e8te ou filtr\u00e9e Status 200, nombres corrects, champs calcul\u00e9s (<code>file_size_display</code>) Filtrage par \u00e9cole Filtrage fichiers pour une \u00e9cole sp\u00e9cifique Status 200, uniquement fichiers de l'\u00e9cole demand\u00e9e Filtrage par type Filtrage fichiers par <code>file_type</code> Status 200, tous fichiers retourn\u00e9s ont le type demand\u00e9 Filtrage par utilisateur (<code>my_files</code>) Affiche uniquement fichiers upload\u00e9s par l'utilisateur courant Status 200, fichiers uniquement de l'utilisateur D\u00e9tails d\u2019un fichier R\u00e9cup\u00e8re les d\u00e9tails d\u2019un fichier sp\u00e9cifique Status 200, <code>filename</code>, <code>description</code>, <code>ecole_name</code> corrects API - Suppression Suppression utilisateur standard Non admin ne peut pas supprimer Status 403, fichier toujours en base Suppression par admin Superuser peut supprimer Status 204, fichier supprim\u00e9 API - T\u00e9l\u00e9chargement Download fichier V\u00e9rifie t\u00e9l\u00e9chargement avec headers corrects Status 200, <code>Content-Disposition</code> correct, mime_type correct Tests sans pagination Lecture / filtrage simplifi\u00e9 Filtrage et lecture quand pagination d\u00e9sactiv\u00e9e Status 200, fichiers filtr\u00e9s correctement"},{"location":"api/users/","title":"Module Users","text":"<p>Le module Users g\u00e8re l\u2019authentification et la gestion des utilisateurs dans le projet Django. Il fournit toutes les fonctionnalit\u00e9s n\u00e9cessaires pour enregistrer, connecter, d\u00e9connecter les utilisateurs, et g\u00e9rer leurs r\u00f4les.</p> <p>Le module est structur\u00e9 en cinq composants principaux : mod\u00e8les, s\u00e9rialiseurs, vues, URLs et tests.</p>"},{"location":"api/users/#1-modeles-usersmodels","title":"1. Mod\u00e8les (<code>users.models</code>)","text":"<ul> <li>D\u00e9finit le mod\u00e8le <code>User</code> personnalis\u00e9 ou utilise le mod\u00e8le Django par d\u00e9faut.  </li> <li>Peut inclure des champs suppl\u00e9mentaires tels que <code>role</code> pour distinguer les types d\u2019utilisateurs (admin, utilisateur standard, etc.).  </li> <li>Sert de base pour l\u2019authentification et la gestion des permissions.  </li> </ul>"},{"location":"api/users/#users.models.User","title":"<code>User</code>","text":"<p>               Bases: <code>AbstractUser</code></p> <p>Mod\u00e8le personnalis\u00e9 d'utilisateur.</p> <p>H\u00e9rite de <code>AbstractUser</code> et peut \u00eatre \u00e9tendu avec des champs suppl\u00e9mentaires. Utilis\u00e9 pour l'authentification et la gestion des comptes.</p> Source code in <code>users/models.py</code> <pre><code>class User(AbstractUser):\n    \"\"\"Mod\u00e8le personnalis\u00e9 d'utilisateur.\n\n    H\u00e9rite de `AbstractUser` et peut \u00eatre \u00e9tendu avec des champs suppl\u00e9mentaires.\n    Utilis\u00e9 pour l'authentification et la gestion des comptes.\n    \"\"\"\n\n    ROLE_CHOICES = (\n        ('admin', 'Admin'),\n        ('user', 'User'),\n    )\n    role = models.CharField(max_length=10, choices=ROLE_CHOICES, default='user')\n\n    def __str__(self):\n        return self.username\n</code></pre>"},{"location":"api/users/#2-serialiseurs-usersserializers","title":"2. S\u00e9rialiseurs (<code>users.serializers</code>)","text":"<ul> <li>Les s\u00e9rialiseurs transforment les instances de mod\u00e8le en formats JSON et valident les donn\u00e9es entrantes.  </li> <li>Exemple :</li> <li><code>RegisterSerializer</code> : validation et cr\u00e9ation d\u2019un utilisateur lors de l\u2019inscription.  </li> </ul>"},{"location":"api/users/#users.serializers.RegisterSerializer","title":"<code>RegisterSerializer</code>","text":"<p>               Bases: <code>ModelSerializer</code></p> <p>S\u00e9rialiseur pour l'inscription d'un nouvel utilisateur.</p> <ul> <li>Valide le mot de passe selon les r\u00e8gles d\u00e9finies dans Django.</li> <li>Permet de d\u00e9finir le r\u00f4le de l'utilisateur ('admin' ou 'user').</li> <li>Sert \u00e0 cr\u00e9er un utilisateur via l'API REST.</li> </ul> Source code in <code>users/serializers.py</code> <pre><code>class RegisterSerializer(serializers.ModelSerializer):\n    \"\"\"\n    S\u00e9rialiseur pour l'inscription d'un nouvel utilisateur.\n\n    - Valide le mot de passe selon les r\u00e8gles d\u00e9finies dans Django.\n    - Permet de d\u00e9finir le r\u00f4le de l'utilisateur ('admin' ou 'user').\n    - Sert \u00e0 cr\u00e9er un utilisateur via l'API REST.\n    \"\"\"\n\n    # Champ mot de passe, uniquement en \u00e9criture\n    password = serializers.CharField(\n        write_only=True,\n        required=True,\n        validators=[validate_password]  # validation selon les r\u00e8gles Django\n    )\n\n    # Champ r\u00f4le avec choix pr\u00e9d\u00e9finis\n    role = serializers.ChoiceField(\n        choices=User.ROLE_CHOICES,\n        default='user'\n    )\n\n    class Meta:\n        model = User\n        fields = ('username', 'email', 'password', 'role')\n\n    def create(self, validated_data):\n        \"\"\"\n        Cr\u00e9e un nouvel utilisateur avec les donn\u00e9es valid\u00e9es.\n\n        - `username` : nom d'utilisateur obligatoire\n        - `email` : email optionnel\n        - `password` : mot de passe valid\u00e9\n        - `role` : r\u00f4le de l'utilisateur (par d\u00e9faut 'user')\n\n        Retourne l'instance utilisateur cr\u00e9\u00e9e.\n        \"\"\"\n        user = User.objects.create_user(\n            username=validated_data['username'],\n            email=validated_data.get('email', ''),\n            password=validated_data['password'],\n            role=validated_data.get('role', 'user')\n        )\n        return user\n</code></pre>"},{"location":"api/users/#users.serializers.RegisterSerializer.create","title":"<code>create(validated_data)</code>","text":"<p>Cr\u00e9e un nouvel utilisateur avec les donn\u00e9es valid\u00e9es.</p> <ul> <li><code>username</code> : nom d'utilisateur obligatoire</li> <li><code>email</code> : email optionnel</li> <li><code>password</code> : mot de passe valid\u00e9</li> <li><code>role</code> : r\u00f4le de l'utilisateur (par d\u00e9faut 'user')</li> </ul> <p>Retourne l'instance utilisateur cr\u00e9\u00e9e.</p> Source code in <code>users/serializers.py</code> <pre><code>def create(self, validated_data):\n    \"\"\"\n    Cr\u00e9e un nouvel utilisateur avec les donn\u00e9es valid\u00e9es.\n\n    - `username` : nom d'utilisateur obligatoire\n    - `email` : email optionnel\n    - `password` : mot de passe valid\u00e9\n    - `role` : r\u00f4le de l'utilisateur (par d\u00e9faut 'user')\n\n    Retourne l'instance utilisateur cr\u00e9\u00e9e.\n    \"\"\"\n    user = User.objects.create_user(\n        username=validated_data['username'],\n        email=validated_data.get('email', ''),\n        password=validated_data['password'],\n        role=validated_data.get('role', 'user')\n    )\n    return user\n</code></pre>"},{"location":"api/users/#3-vues-usersviews","title":"3. Vues (<code>users.views</code>)","text":"<p>Les vues contiennent les endpoints REST API pour l\u2019authentification :</p> Endpoint M\u00e9thode Permissions Description <code>/register/</code> POST AllowAny Inscription d\u2019un nouvel utilisateur. Retourne un message de succ\u00e8s si l\u2019utilisateur est cr\u00e9\u00e9. <code>/login/</code> POST AllowAny Connexion d\u2019un utilisateur existant. Retourne un JWT (access + refresh) et les informations de l\u2019utilisateur. <code>/logout/</code> POST IsAuthenticated D\u00e9connexion d\u2019un utilisateur. Blackliste le refresh token pour s\u00e9curiser la session. <ul> <li>Utilise DRF et Simple JWT pour g\u00e9rer l\u2019authentification et les tokens.  </li> </ul>"},{"location":"api/users/#users.views.login","title":"<code>login(request)</code>","text":"<p>Endpoint pour connecter un utilisateur et g\u00e9n\u00e9rer un JWT. Accessible \u00e0 tous (pas besoin d'authentification).</p> <p>Re\u00e7oit dans request.data :     - username : str     - password : str</p> Processus <ol> <li>Authentifie l'utilisateur via username/password.</li> <li>Si authentification r\u00e9ussie :<ul> <li>G\u00e9n\u00e8re un token JWT (access + refresh).</li> <li>Retourne le username et role de l'utilisateur.</li> </ul> </li> <li>Si \u00e9chec de l'authentification :<ul> <li>Retourne 401 Unauthorized avec message d'erreur.</li> </ul> </li> </ol> Source code in <code>users/views.py</code> <pre><code>@api_view(['POST'])\n@permission_classes([AllowAny])\ndef login(request):\n    \"\"\"\n    Endpoint pour connecter un utilisateur et g\u00e9n\u00e9rer un JWT.\n    Accessible \u00e0 tous (pas besoin d'authentification).\n\n    Re\u00e7oit dans request.data :\n        - username : str\n        - password : str\n\n    Processus :\n        1. Authentifie l'utilisateur via username/password.\n        2. Si authentification r\u00e9ussie :\n            - G\u00e9n\u00e8re un token JWT (access + refresh).\n            - Retourne le username et role de l'utilisateur.\n        3. Si \u00e9chec de l'authentification :\n            - Retourne 401 Unauthorized avec message d'erreur.\n    \"\"\"\n    username = request.data.get('username')\n    password = request.data.get('password')\n    user = authenticate(username=username, password=password)\n    if user:\n        # Cr\u00e9ation d'un token JWT pour l'utilisateur\n        refresh = RefreshToken.for_user(user)\n        return Response({\n            \"refresh\": str(refresh),\n            \"access\": str(refresh.access_token),\n            \"username\": user.username,\n            \"role\": user.role,\n        })\n    return Response({\"error\": \"Identifiants invalides\"}, status=status.HTTP_401_UNAUTHORIZED)\n</code></pre>"},{"location":"api/users/#users.views.logout","title":"<code>logout(request)</code>","text":"<p>Endpoint pour d\u00e9connecter un utilisateur. N\u00e9cessite que l'utilisateur soit authentifi\u00e9 (JWT access token).</p> <p>Re\u00e7oit dans request.data :     - refresh : str (token JWT de rafra\u00eechissement)</p> Processus <ol> <li>V\u00e9rifie la pr\u00e9sence du token refresh.</li> <li>Blackliste le token pour emp\u00eacher toute r\u00e9utilisation.</li> <li>Retourne un message de succ\u00e8s ou une erreur si le token est invalide.</li> </ol> Remarque <ul> <li>Utilise la fonctionnalit\u00e9 de blacklist de Simple JWT.</li> <li>Si le token est d\u00e9j\u00e0 expir\u00e9 ou blacklist\u00e9, une erreur est renvoy\u00e9e.</li> </ul> Source code in <code>users/views.py</code> <pre><code>@api_view(['POST'])\n@permission_classes([IsAuthenticated])\ndef logout(request):\n    \"\"\"\n    Endpoint pour d\u00e9connecter un utilisateur.\n    N\u00e9cessite que l'utilisateur soit authentifi\u00e9 (JWT access token).\n\n    Re\u00e7oit dans request.data :\n        - refresh : str (token JWT de rafra\u00eechissement)\n\n    Processus :\n        1. V\u00e9rifie la pr\u00e9sence du token refresh.\n        2. Blackliste le token pour emp\u00eacher toute r\u00e9utilisation.\n        3. Retourne un message de succ\u00e8s ou une erreur si le token est invalide.\n\n    Remarque :\n        - Utilise la fonctionnalit\u00e9 de blacklist de Simple JWT.\n        - Si le token est d\u00e9j\u00e0 expir\u00e9 ou blacklist\u00e9, une erreur est renvoy\u00e9e.\n    \"\"\"\n    refresh_token = request.data.get(\"refresh\")\n\n    if not refresh_token:\n        return Response({\"error\": \"Token manquant\"}, status=status.HTTP_400_BAD_REQUEST)\n\n    try:\n        token = RefreshToken(refresh_token)\n        token.blacklist()  # Ajout du token \u00e0 la blacklist\n        return Response({\"message\": \"D\u00e9connexion r\u00e9ussie \u2705\"}, status=status.HTTP_205_RESET_CONTENT)\n    except Exception as e:\n        # Peu importe l'erreur (token expir\u00e9, invalide ou d\u00e9j\u00e0 blacklist\u00e9)\n        return Response({\"error\": \"Token invalide ou d\u00e9j\u00e0 utilis\u00e9\"}, status=status.HTTP_400_BAD_REQUEST)\n</code></pre>"},{"location":"api/users/#users.views.register","title":"<code>register(request)</code>","text":"<p>Endpoint pour enregistrer un nouvel utilisateur. Accessible \u00e0 tous (pas besoin d'authentification).</p> <p>Re\u00e7oit dans request.data :     - username : str     - email : str (optionnel selon le serializer)     - password : str     - role : str (optionnel selon le mod\u00e8le User)</p> Retourne <ul> <li>201 CREATED avec un message de succ\u00e8s si l'utilisateur est cr\u00e9\u00e9.</li> <li>400 BAD REQUEST avec les erreurs du serializer sinon.</li> </ul> Source code in <code>users/views.py</code> <pre><code>@api_view(['POST'])\n@permission_classes([AllowAny])\ndef register(request):\n    \"\"\"\n    Endpoint pour enregistrer un nouvel utilisateur.\n    Accessible \u00e0 tous (pas besoin d'authentification).\n\n    Re\u00e7oit dans request.data :\n        - username : str\n        - email : str (optionnel selon le serializer)\n        - password : str\n        - role : str (optionnel selon le mod\u00e8le User)\n\n    Retourne :\n        - 201 CREATED avec un message de succ\u00e8s si l'utilisateur est cr\u00e9\u00e9.\n        - 400 BAD REQUEST avec les erreurs du serializer sinon.\n    \"\"\"\n    serializer = RegisterSerializer(data=request.data)\n    if serializer.is_valid():\n        serializer.save()\n        return Response({\"message\": \"Utilisateur cr\u00e9\u00e9 avec succ\u00e8s \u2705\"}, status=status.HTTP_201_CREATED)\n    return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)\n</code></pre>"},{"location":"api/users/#4-urls-usersurls","title":"4. URLs (<code>users.urls</code>)","text":"<ul> <li>Configure le routing API pour le module Users.  </li> <li>Chaque URL est reli\u00e9e \u00e0 sa vue correspondante dans <code>users.views</code>.  </li> </ul>"},{"location":"api/users/#5-tests-userstests","title":"5. Tests (<code>users.tests</code>)","text":"<ul> <li>Contient des tests unitaires pour valider le fonctionnement du module Users.  </li> <li>Utilise <code>APITestCase</code> de DRF pour simuler les requ\u00eates HTTP.  </li> <li>Couvre tous les sc\u00e9narios principaux : inscription, connexion, d\u00e9connexion et gestion des tokens.  </li> </ul>"},{"location":"api/users/#users.tests.AuthTests","title":"<code>AuthTests</code>","text":"<p>               Bases: <code>APITestCase</code></p> <p>Suite de tests pour les endpoints d'authentification : - Inscription (register) - Connexion (login) - D\u00e9connexion (logout)</p> Source code in <code>users/tests.py</code> <pre><code>class AuthTests(APITestCase):\n    \"\"\"\n    Suite de tests pour les endpoints d'authentification :\n    - Inscription (register)\n    - Connexion (login)\n    - D\u00e9connexion (logout)\n    \"\"\"\n\n    def setUp(self):\n        \"\"\"\n        Initialisation avant chaque test :\n        - D\u00e9finition des URLs pour register, login et logout\n        - Pr\u00e9paration des donn\u00e9es de test pour un utilisateur\n        - Cr\u00e9ation d'un utilisateur admin pour les tests\n        \"\"\"\n        self.register_url = reverse('register')\n        self.login_url = reverse('login')\n        self.logout_url = reverse('logout')\n        self.user_data = {\n            \"username\": \"noura\",\n            \"password\": \"strongpassword123\",\n            \"email\": \"noura@example.com\"\n        }\n        self.admin_user = User.objects.create_user(\n            username=\"admin\",\n            email=\"admin@example.com\",\n            password=\"adminpass123\",\n            role=\"admin\"\n        )\n\n    def test_register_user(self):\n        \"\"\"\n        Test: Inscription d'un nouvel utilisateur.\n\n        V\u00e9rifie que l'utilisateur peut \u00eatre cr\u00e9\u00e9 via l'endpoint register.\n\n        Asserts:\n            - Status code: 201 Created\n            - R\u00e9ponse contient un message de succ\u00e8s\n            - L'utilisateur existe dans la base de donn\u00e9es\n        \"\"\"\n        response = self.client.post(self.register_url, self.user_data, format='json')\n        self.assertEqual(response.status_code, status.HTTP_201_CREATED)\n        self.assertIn('message', response.data)\n        self.assertTrue(User.objects.filter(username='noura').exists())\n\n    def test_login_valid_user(self):\n        \"\"\"\n        Test: Connexion avec un utilisateur valide.\n\n        V\u00e9rifie que l'utilisateur existant peut se connecter et obtenir les tokens JWT.\n\n        Asserts:\n            - Status code: 200 OK\n            - R\u00e9ponse contient un token 'access'\n            - R\u00e9ponse contient un token 'refresh'\n        \"\"\"\n        User.objects.create_user(username=\"testuser\", password=\"testpass123\")\n        response = self.client.post(self.login_url, {\n            \"username\": \"testuser\",\n            \"password\": \"testpass123\"\n        }, format='json')\n        self.assertEqual(response.status_code, status.HTTP_200_OK)\n        self.assertIn('access', response.data)\n        self.assertIn('refresh', response.data)\n\n    def test_login_invalid_user(self):\n        \"\"\"\n        Test: Connexion avec des identifiants invalides.\n\n        V\u00e9rifie que l'acc\u00e8s est refus\u00e9 pour des informations incorrectes.\n\n        Asserts:\n            - Status code: 401 Unauthorized\n        \"\"\"\n        response = self.client.post(self.login_url, {\n            \"username\": \"wrong\",\n            \"password\": \"wrong\"\n        }, format='json')\n        self.assertEqual(response.status_code, status.HTTP_401_UNAUTHORIZED)\n\n    def test_logout_valid_token(self):\n        \"\"\"\n        Test: D\u00e9connexion avec un refresh token valide.\n\n        V\u00e9rifie que l'utilisateur peut se d\u00e9connecter et que le refresh token est blacklist\u00e9.\n\n        Asserts:\n            - Status code: 205 Reset Content\n        \"\"\"\n        user = User.objects.create_user(username=\"logoutuser\", password=\"logoutpass123\")\n        refresh = RefreshToken.for_user(user)\n        self.client.credentials(HTTP_AUTHORIZATION=f'Bearer {refresh.access_token}')\n\n        response = self.client.post(self.logout_url, {\"refresh\": str(refresh)}, format='json')\n        self.assertEqual(response.status_code, status.HTTP_205_RESET_CONTENT)\n\n    def test_logout_invalid_token(self):\n        \"\"\"\n        Test: D\u00e9connexion avec un refresh token invalide.\n\n        V\u00e9rifie que la d\u00e9connexion \u00e9choue si le refresh token est incorrect ou d\u00e9j\u00e0 utilis\u00e9.\n\n        Asserts:\n            - Status code: 400 Bad Request\n        \"\"\"\n        user = User.objects.create_user(username=\"fakeuser\", password=\"fakepass123\")\n        refresh = RefreshToken.for_user(user)\n        self.client.credentials(HTTP_AUTHORIZATION=f'Bearer {refresh.access_token}')\n\n        response = self.client.post(self.logout_url, {\"refresh\": \"invalidtoken\"}, format='json')\n        self.assertEqual(response.status_code, status.HTTP_400_BAD_REQUEST)\n</code></pre>"},{"location":"api/users/#users.tests.AuthTests.setUp","title":"<code>setUp()</code>","text":"<p>Initialisation avant chaque test : - D\u00e9finition des URLs pour register, login et logout - Pr\u00e9paration des donn\u00e9es de test pour un utilisateur - Cr\u00e9ation d'un utilisateur admin pour les tests</p> Source code in <code>users/tests.py</code> <pre><code>def setUp(self):\n    \"\"\"\n    Initialisation avant chaque test :\n    - D\u00e9finition des URLs pour register, login et logout\n    - Pr\u00e9paration des donn\u00e9es de test pour un utilisateur\n    - Cr\u00e9ation d'un utilisateur admin pour les tests\n    \"\"\"\n    self.register_url = reverse('register')\n    self.login_url = reverse('login')\n    self.logout_url = reverse('logout')\n    self.user_data = {\n        \"username\": \"noura\",\n        \"password\": \"strongpassword123\",\n        \"email\": \"noura@example.com\"\n    }\n    self.admin_user = User.objects.create_user(\n        username=\"admin\",\n        email=\"admin@example.com\",\n        password=\"adminpass123\",\n        role=\"admin\"\n    )\n</code></pre>"},{"location":"api/users/#users.tests.AuthTests.test_login_invalid_user","title":"<code>test_login_invalid_user()</code>","text":"<p>Test: Connexion avec des identifiants invalides.</p> <p>V\u00e9rifie que l'acc\u00e8s est refus\u00e9 pour des informations incorrectes.</p> Asserts <ul> <li>Status code: 401 Unauthorized</li> </ul> Source code in <code>users/tests.py</code> <pre><code>def test_login_invalid_user(self):\n    \"\"\"\n    Test: Connexion avec des identifiants invalides.\n\n    V\u00e9rifie que l'acc\u00e8s est refus\u00e9 pour des informations incorrectes.\n\n    Asserts:\n        - Status code: 401 Unauthorized\n    \"\"\"\n    response = self.client.post(self.login_url, {\n        \"username\": \"wrong\",\n        \"password\": \"wrong\"\n    }, format='json')\n    self.assertEqual(response.status_code, status.HTTP_401_UNAUTHORIZED)\n</code></pre>"},{"location":"api/users/#users.tests.AuthTests.test_login_valid_user","title":"<code>test_login_valid_user()</code>","text":"<p>Test: Connexion avec un utilisateur valide.</p> <p>V\u00e9rifie que l'utilisateur existant peut se connecter et obtenir les tokens JWT.</p> Asserts <ul> <li>Status code: 200 OK</li> <li>R\u00e9ponse contient un token 'access'</li> <li>R\u00e9ponse contient un token 'refresh'</li> </ul> Source code in <code>users/tests.py</code> <pre><code>def test_login_valid_user(self):\n    \"\"\"\n    Test: Connexion avec un utilisateur valide.\n\n    V\u00e9rifie que l'utilisateur existant peut se connecter et obtenir les tokens JWT.\n\n    Asserts:\n        - Status code: 200 OK\n        - R\u00e9ponse contient un token 'access'\n        - R\u00e9ponse contient un token 'refresh'\n    \"\"\"\n    User.objects.create_user(username=\"testuser\", password=\"testpass123\")\n    response = self.client.post(self.login_url, {\n        \"username\": \"testuser\",\n        \"password\": \"testpass123\"\n    }, format='json')\n    self.assertEqual(response.status_code, status.HTTP_200_OK)\n    self.assertIn('access', response.data)\n    self.assertIn('refresh', response.data)\n</code></pre>"},{"location":"api/users/#users.tests.AuthTests.test_logout_invalid_token","title":"<code>test_logout_invalid_token()</code>","text":"<p>Test: D\u00e9connexion avec un refresh token invalide.</p> <p>V\u00e9rifie que la d\u00e9connexion \u00e9choue si le refresh token est incorrect ou d\u00e9j\u00e0 utilis\u00e9.</p> Asserts <ul> <li>Status code: 400 Bad Request</li> </ul> Source code in <code>users/tests.py</code> <pre><code>def test_logout_invalid_token(self):\n    \"\"\"\n    Test: D\u00e9connexion avec un refresh token invalide.\n\n    V\u00e9rifie que la d\u00e9connexion \u00e9choue si le refresh token est incorrect ou d\u00e9j\u00e0 utilis\u00e9.\n\n    Asserts:\n        - Status code: 400 Bad Request\n    \"\"\"\n    user = User.objects.create_user(username=\"fakeuser\", password=\"fakepass123\")\n    refresh = RefreshToken.for_user(user)\n    self.client.credentials(HTTP_AUTHORIZATION=f'Bearer {refresh.access_token}')\n\n    response = self.client.post(self.logout_url, {\"refresh\": \"invalidtoken\"}, format='json')\n    self.assertEqual(response.status_code, status.HTTP_400_BAD_REQUEST)\n</code></pre>"},{"location":"api/users/#users.tests.AuthTests.test_logout_valid_token","title":"<code>test_logout_valid_token()</code>","text":"<p>Test: D\u00e9connexion avec un refresh token valide.</p> <p>V\u00e9rifie que l'utilisateur peut se d\u00e9connecter et que le refresh token est blacklist\u00e9.</p> Asserts <ul> <li>Status code: 205 Reset Content</li> </ul> Source code in <code>users/tests.py</code> <pre><code>def test_logout_valid_token(self):\n    \"\"\"\n    Test: D\u00e9connexion avec un refresh token valide.\n\n    V\u00e9rifie que l'utilisateur peut se d\u00e9connecter et que le refresh token est blacklist\u00e9.\n\n    Asserts:\n        - Status code: 205 Reset Content\n    \"\"\"\n    user = User.objects.create_user(username=\"logoutuser\", password=\"logoutpass123\")\n    refresh = RefreshToken.for_user(user)\n    self.client.credentials(HTTP_AUTHORIZATION=f'Bearer {refresh.access_token}')\n\n    response = self.client.post(self.logout_url, {\"refresh\": str(refresh)}, format='json')\n    self.assertEqual(response.status_code, status.HTTP_205_RESET_CONTENT)\n</code></pre>"},{"location":"api/users/#users.tests.AuthTests.test_register_user","title":"<code>test_register_user()</code>","text":"<p>Test: Inscription d'un nouvel utilisateur.</p> <p>V\u00e9rifie que l'utilisateur peut \u00eatre cr\u00e9\u00e9 via l'endpoint register.</p> Asserts <ul> <li>Status code: 201 Created</li> <li>R\u00e9ponse contient un message de succ\u00e8s</li> <li>L'utilisateur existe dans la base de donn\u00e9es</li> </ul> Source code in <code>users/tests.py</code> <pre><code>def test_register_user(self):\n    \"\"\"\n    Test: Inscription d'un nouvel utilisateur.\n\n    V\u00e9rifie que l'utilisateur peut \u00eatre cr\u00e9\u00e9 via l'endpoint register.\n\n    Asserts:\n        - Status code: 201 Created\n        - R\u00e9ponse contient un message de succ\u00e8s\n        - L'utilisateur existe dans la base de donn\u00e9es\n    \"\"\"\n    response = self.client.post(self.register_url, self.user_data, format='json')\n    self.assertEqual(response.status_code, status.HTTP_201_CREATED)\n    self.assertIn('message', response.data)\n    self.assertTrue(User.objects.filter(username='noura').exists())\n</code></pre>"},{"location":"api/users/#51-tableau-recapitulatif-des-tests","title":"5.1. Tableau r\u00e9capitulatif des tests","text":"Test Description <code>test_register_user</code> V\u00e9rifie l\u2019inscription d\u2019un utilisateur et la cr\u00e9ation en base. <code>test_login_valid_user</code> V\u00e9rifie la connexion d\u2019un utilisateur existant et la g\u00e9n\u00e9ration des JWT. <code>test_login_invalid_user</code> V\u00e9rifie le comportement avec des identifiants invalides. <code>test_logout_valid_token</code> V\u00e9rifie la d\u00e9connexion avec un refresh token valide (blacklist). <code>test_logout_invalid_token</code> V\u00e9rifie la gestion des refresh tokens invalides ou d\u00e9j\u00e0 utilis\u00e9s."}]}